<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#1a1a2e">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="description" content="CER Ouezzinville Nord - Temple Philadelphie ‚Äî Application officielle de l'√©glise">
<title>CER Ouezzinville Nord - Temple Philadelphie</title>

<!-- PWA Manifest (inline) -->
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQ0VSIE91ZXp6aW52aWxsZSBOb3JkIC0gVGVtcGxlIFBoaWxhZGVscGhpZSIsInNob3J0X25hbWUiOiJQaGlsYWRlbHBoaWUiLCJzdGFydF91cmwiOiIuIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzBmMGYyMyIsInRoZW1lX2NvbG9yIjoiIzFhMWEyZSIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSFpwWlhkQ2IzZzlJakFnTUNBeE9USWdNVGt5SWo0OFkybHlZMnhsSUdONFBTSTVOaUlnWTNrOUlqazJJaUJ5UFNJMk5DSWdabWxzYkQwaUl6TTBNRE5tSWk4K1BHTnBjbU5zWlNCamVEMGlPVFlpSUdONVBTSTVOaUlnY2owaU9EQWlJR1pwYkd3OUltNXZibVVpSUhOMGNtOXJaVDBpSTJaVVlUWXlNeUlnYzNSeWIydGxMWGRwWkhSb1BTSXpJaTgrUEhSbGVIUWdlRDBpT1RZaUlIazlJakV3T0NJZ1ptOXVkQzF6YVhwbFBTSXpOaUlnWm1sc2JEMGlJMlpVWVRZeU15SWdkR1Y0ZEMxaGJtTm9iM0k5SW0xcFpHUnNaU0krNG9LZFBDOTBaWGgwUGp3dmMzWm5QZz09Iiwic2l6ZXMiOiIxOTJ4MTkyIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
<link rel="shortcut icon" href="./logo-site.png">
<style>
/* ====================================
   üé® VARIABLES & RESET (identique √† la version pr√©c√©dente)
   ==================================== */
:root {
  --primary: #3d3d8a;
  --primary-light: #6c6cc8;
  --primary-dark: #2a2a6e;
  --secondary: #c9a227;
  --secondary-light: #f0d060;
  --accent: #f5a623;
  --bg-dark: #0f0f23;
  --bg-card: rgba(255,255,255,0.06);
  --bg-glass: rgba(255,255,255,0.08);
  --border-glass: rgba(255,255,255,0.12);
  --text-primary: #ffffff;
  --text-secondary: rgba(255,255,255,0.7);
  --text-muted: rgba(255,255,255,0.4);
  --success: #00c853;
  --warning: #ff9800;
  --danger: #f44336;
  --meditation: #7c4dff;
  --meditation-light: #b388ff;
  --gold: #c9a227;
  --gold-light: #f0d060;
  --radius: 16px;
  --radius-sm: 10px;
  --shadow: 0 8px 32px rgba(0,0,0,0.3);
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  --navbar-height: 64px;
  --bottomnav-height: 70px;
}

* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior:smooth; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--bg-dark);
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
  -webkit-tap-highlight-color: transparent;
  /* Image de fond */
  background-image: url('./IMG_20251230_143301.jpg');
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(10, 10, 20, 0.75);
  backdrop-filter: blur(4px);
  z-index: -1;
}

body.light-mode {
  --bg-dark: #f0f2f5;
  --bg-card: rgba(0,0,0,0.04);
  --bg-glass: rgba(255,255,255,0.75);
  --border-glass: rgba(0,0,0,0.1);
  --text-primary: #1a1a2e;
  --text-secondary: rgba(0,0,0,0.6);
  --text-muted: rgba(0,0,0,0.35);
  --shadow: 0 8px 32px rgba(0,0,0,0.1);
}

::-webkit-scrollbar { width:6px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:var(--primary); border-radius:3px; }

/* ====================================
   LOADER
   ==================================== */
#loader {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:linear-gradient(135deg, #0f0f23, #1a1a3e);
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  z-index:10000; transition:opacity .6s, visibility .6s;
}
#loader.hidden { opacity:0; visibility:hidden; }
.loader-logo {
  width:90px; height:90px;
  background:linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  font-size:40px;
  box-shadow: 0 0 40px rgba(201,162,39,0.3);
  animation: loaderPulse 2s ease-in-out infinite;
}
@keyframes loaderPulse {
  0%,100% { transform:scale(1); box-shadow:0 0 40px rgba(201,162,39,0.3); }
  50% { transform:scale(1.08); box-shadow:0 0 60px rgba(201,162,39,0.5); }
}
.loader-church-name {
  margin-top:20px; font-size:16px; font-weight:700;
  text-align:center; line-height:1.4;
  background:linear-gradient(135deg, var(--gold-light), var(--gold));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
}
.loader-church-sub { font-size:13px; color:var(--text-muted); margin-top:6px; letter-spacing:2px; text-transform:uppercase; }
.loader-spinner { width:40px; height:40px; border:3px solid var(--border-glass); border-top-color:var(--gold); border-radius:50%; animation:spin .8s linear infinite; margin-top:24px; }
@keyframes spin { to { transform:rotate(360deg); } }

/* ====================================
   NAVBAR
   ==================================== */
.navbar {
  position:fixed; top:0; left:0; right:0;
  height:var(--navbar-height);
  background:var(--bg-glass); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border-glass);
  display:flex; align-items:center; justify-content:space-between;
  padding:0 12px; z-index:1000;
}
.navbar-brand { display:flex; align-items:center; gap:10px; min-width:0; flex:1; }
.navbar-brand .logo {
  width:40px; height:40px; min-width:40px;
  background:linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius:12px;
  display:flex; align-items:center; justify-content:center;
  font-size:20px;
  box-shadow:0 2px 12px rgba(201,162,39,0.3);
}
.navbar-brand .brand-text { overflow:hidden; }
.navbar-brand .brand-name {
  font-weight:800; font-size:13px; line-height:1.2; white-space:nowrap;
  overflow:hidden; text-overflow:ellipsis;
  background:linear-gradient(135deg, var(--gold-light), var(--text-primary));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
}
.navbar-brand .brand-sub { font-size:10px; color:var(--text-muted); font-weight:600; letter-spacing:0.5px; }
.navbar-actions { display:flex; align-items:center; gap:6px; }
.nav-btn {
  width:38px; height:38px; border:none;
  background:var(--bg-card); color:var(--text-primary);
  border-radius:10px; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
  font-size:16px; transition:var(--transition); position:relative;
}
.nav-btn:hover { background:var(--primary); transform:scale(1.05); }
.nav-btn .badge { position:absolute; top:-2px; right:-2px; width:16px; height:16px; background:var(--secondary); border-radius:50%; font-size:9px; display:flex; align-items:center; justify-content:center; font-weight:700; color:#000; }

/* Language */
.lang-dropdown { position:relative; }
.lang-dropdown-menu { position:absolute; top:46px; right:0; background:var(--bg-glass); backdrop-filter:blur(20px); border:1px solid var(--border-glass); border-radius:var(--radius-sm); padding:6px; display:none; min-width:140px; z-index:1001; }
.lang-dropdown-menu.show { display:block; }
.lang-option { display:flex; align-items:center; gap:8px; padding:8px 10px; border-radius:6px; cursor:pointer; transition:var(--transition); font-size:13px; }
.lang-option:hover,.lang-option.active { background:var(--primary); }

/* ====================================
   BOTTOM NAV (8 items, scrollable)
   ==================================== */
.bottom-nav {
  position:fixed; bottom:0; left:0; right:0;
  height:var(--bottomnav-height);
  background:var(--bg-glass); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px);
  border-top:1px solid var(--border-glass);
  display:flex;
  align-items:center;
  justify-content:space-around;
  overflow-x: auto;
  z-index:1000;
  padding-bottom:env(safe-area-inset-bottom,0);
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none; /* Firefox */
}
.bottom-nav::-webkit-scrollbar { display: none; } /* Chrome, Safari */
.bottom-nav-item {
  display:flex; flex-direction:column; align-items:center; gap:2px;
  cursor:pointer; padding:6px 10px; border-radius:10px; transition:var(--transition);
  color:var(--text-muted); font-size:9px; font-weight:600;
  text-transform:uppercase; letter-spacing:.3px;
  border:none; background:none; -webkit-tap-highlight-color:transparent;
  white-space: nowrap;
}
.bottom-nav-item .icon { font-size:20px; transition:var(--transition); }
.bottom-nav-item.active { color:var(--gold); }
.bottom-nav-item.active .icon { transform:scale(1.15); }
.bottom-nav-item:active { transform:scale(.92); }

/* ====================================
   MAIN
   ==================================== */
.main-content { padding-top:calc(var(--navbar-height) + 8px); padding-bottom:calc(var(--bottomnav-height) + 16px); min-height:100vh; }
.page { display:none; padding:14px; animation:fadeIn .3s ease; max-width:900px; margin:0 auto; }
.page.active { display:block; }
@keyframes fadeIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }

/* ====================================
   GLASS CARDS
   ==================================== */
.glass-card { background:var(--bg-glass); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); border:1px solid var(--border-glass); border-radius:var(--radius); padding:18px; margin-bottom:14px; transition:var(--transition); }
.glass-card:hover { border-color:rgba(201,162,39,0.3); transform:translateY(-1px); box-shadow:var(--shadow); }
.card-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:14px; }
.card-title { font-size:16px; font-weight:700; display:flex; align-items:center; gap:8px; }

/* ====================================
   BUTTONS
   ==================================== */
.btn { display:inline-flex; align-items:center; justify-content:center; gap:6px; padding:11px 20px; border:none; border-radius:var(--radius-sm); font-size:13px; font-weight:600; cursor:pointer; transition:var(--transition); text-decoration:none; white-space:nowrap; }
.btn-primary { background:linear-gradient(135deg,var(--primary),var(--primary-light)); color:white; }
.btn-primary:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(61,61,138,.4); }
.btn-secondary { background:var(--bg-card); color:var(--text-primary); border:1px solid var(--border-glass); }
.btn-danger { background:linear-gradient(135deg,var(--danger),#e53935); color:white; }
.btn-success { background:linear-gradient(135deg,var(--success),#00e676); color:white; }
.btn-gold { background:linear-gradient(135deg,var(--gold),var(--gold-light)); color:#1a1a2e; font-weight:700; }
.btn-gold:hover { box-shadow:0 6px 20px rgba(201,162,39,.4); }
.btn-meditation { background:linear-gradient(135deg,var(--meditation),var(--meditation-light)); color:white; }
.btn-sm { padding:7px 14px; font-size:11px; }
.btn-block { width:100%; }
.btn:active { transform:scale(.96); }
.btn:disabled { opacity:.5; cursor:not-allowed; }

/* ====================================
   FORMS
   ==================================== */
.form-group { margin-bottom:14px; }
.form-label { display:block; margin-bottom:5px; font-size:12px; font-weight:600; color:var(--text-secondary); text-transform:uppercase; letter-spacing:.5px; }
.form-input,.form-select,.form-textarea { width:100%; padding:11px 14px; background:var(--bg-card); border:1px solid var(--border-glass); border-radius:var(--radius-sm); color:var(--text-primary); font-size:14px; transition:var(--transition); font-family:inherit; }
.form-input:focus,.form-select:focus,.form-textarea:focus { outline:none; border-color:var(--gold); box-shadow:0 0 0 3px rgba(201,162,39,.15); }
.form-textarea { resize:vertical; min-height:80px; }
option { background:#1a1a2e; color:white; }

/* ====================================
   HOME PAGE
   ==================================== */
.welcome-hero {
  text-align:center; padding:30px 16px;
  background:linear-gradient(135deg, rgba(61,61,138,.2), rgba(201,162,39,.1));
  border-radius:var(--radius); margin-bottom:16px;
  border:1px solid rgba(201,162,39,.2);
  position:relative; overflow:hidden;
}
.welcome-hero::before {
  content:''; position:absolute; top:-30px; right:-30px;
  width:120px; height:120px; border-radius:50%;
  background:radial-gradient(circle, rgba(201,162,39,.15), transparent);
}
.welcome-hero .church-logo-large {
  width:70px; height:70px; margin:0 auto 12px;
  background:linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius:50%; display:flex; align-items:center; justify-content:center;
  font-size:32px; box-shadow:0 4px 20px rgba(201,162,39,.3);
}
.welcome-hero h1 {
  font-size:20px; font-weight:800; margin-bottom:4px;
  background:linear-gradient(135deg, var(--gold-light), var(--gold));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
}
.welcome-hero .church-full-name { font-size:14px; color:var(--text-secondary); font-weight:600; }
.welcome-hero .church-verse {
  margin-top:14px; padding:12px; background:rgba(201,162,39,.08);
  border-radius:var(--radius-sm); border-left:3px solid var(--gold);
  font-style:italic; font-size:13px; line-height:1.5; color:var(--text-secondary);
}
.welcome-hero .church-verse .cv-ref { color:var(--gold); font-weight:700; font-style:normal; margin-top:6px; display:block; font-size:12px; }

.stats-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:10px; margin-bottom:20px; }
.stat-card { background:var(--bg-glass); backdrop-filter:blur(20px); border:1px solid var(--border-glass); border-radius:var(--radius); padding:16px; text-align:center; }
.stat-card .stat-icon { font-size:24px; margin-bottom:6px; }
.stat-card .stat-value { font-size:22px; font-weight:800; color:var(--gold); }
.stat-card .stat-label { font-size:10px; color:var(--text-muted); text-transform:uppercase; letter-spacing:1px; margin-top:3px; }

.quick-actions { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; }
.quick-action-btn { display:flex; flex-direction:column; align-items:center; gap:6px; padding:16px 8px; background:var(--bg-glass); border:1px solid var(--border-glass); border-radius:var(--radius); cursor:pointer; transition:var(--transition); color:var(--text-primary); text-decoration:none; font-size:11px; font-weight:600; text-align:center; }
.quick-action-btn:hover { border-color:var(--gold); transform:translateY(-2px); }
.quick-action-btn .qa-icon { font-size:28px; }

.online-bar { text-align:center; padding:6px; font-size:12px; color:var(--success); display:flex; align-items:center; justify-content:center; gap:6px; margin-bottom:12px; }
.online-bar .online-dot { width:8px; height:8px; background:var(--success); border-radius:50%; animation:pulse 2s infinite; }
@keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:.6; } }

/* ====================================
   BIBLE (identique)
   ==================================== */
.bible-controls { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:14px; }
.bible-search { grid-column:1/-1; }
.bible-content { background:var(--bg-glass); border:1px solid var(--border-glass); border-radius:var(--radius); padding:18px; min-height:250px; line-height:1.8; font-size:15px; }
.bible-content .verse { margin-bottom:6px; padding:4px 8px; border-radius:6px; transition:var(--transition); cursor:pointer; }
.bible-content .verse:hover { background:rgba(201,162,39,.08); }
.verse-number { font-weight:800; color:var(--gold); font-size:11px; vertical-align:super; margin-right:3px; }
.bible-audio-controls { display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
.speed-control { display:flex; align-items:center; gap:6px; font-size:12px; color:var(--text-secondary); }
.favorite-item { display:flex; align-items:center; justify-content:space-between; padding:10px; background:var(--bg-card); border-radius:var(--radius-sm); margin-bottom:6px; font-size:13px; }

/* ====================================
   LIVE (enregistrement local)
   ==================================== */
.live-badge { display:inline-flex; align-items:center; gap:5px; background:var(--danger); color:white; padding:3px 10px; border-radius:20px; font-size:11px; font-weight:700; animation:pulse 2s infinite; }
.live-card .live-thumbnail { width:100%; height:170px; background:linear-gradient(135deg,var(--primary-dark),var(--bg-dark)); border-radius:var(--radius-sm); margin-bottom:10px; display:flex; align-items:center; justify-content:center; font-size:44px; overflow:hidden; position:relative; }
.live-card .live-thumbnail img { width:100%; height:100%; object-fit:cover; }

/* Camera */
.camera-container { position:relative; border-radius:var(--radius); overflow:hidden; background:#000; margin:10px 0; }
.camera-container video { width:100%; max-height:280px; object-fit:cover; display:block; }
.camera-preview-img { width:100%; max-height:180px; object-fit:contain; border-radius:var(--radius-sm); margin:8px 0; }

/* Sermons */
.youtube-embed { width:100%; aspect-ratio:16/9; border-radius:var(--radius); border:none; }
.upload-progress { width:100%; height:5px; background:var(--bg-card); border-radius:3px; overflow:hidden; margin:8px 0; }
.upload-progress-bar { height:100%; background:linear-gradient(90deg,var(--gold),var(--gold-light)); border-radius:3px; transition:width .3s; width:0%; }

/* Gallery */
.gallery-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:8px; }
.gallery-item { aspect-ratio:1; border-radius:var(--radius-sm); overflow:hidden; cursor:pointer; transition:var(--transition); position:relative; }
.gallery-item:hover { transform:scale(1.03); }
.gallery-item img { width:100%; height:100%; object-fit:cover; }
.gallery-item .delete-overlay { position:absolute; top:4px; right:4px; width:26px; height:26px; background:rgba(244,67,54,.9); border-radius:50%; display:none; align-items:center; justify-content:center; cursor:pointer; font-size:12px; }
.gallery-item:hover .delete-overlay { display:flex; }

/* Modal */
.modal-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.85); backdrop-filter:blur(10px); display:none; align-items:center; justify-content:center; z-index:5000; padding:16px; }
.modal-overlay.show { display:flex; }
.modal-content { background:var(--bg-glass); backdrop-filter:blur(20px); border:1px solid var(--border-glass); border-radius:var(--radius); width:100%; max-width:480px; max-height:90vh; overflow-y:auto; padding:22px; animation:modalIn .3s ease; }
@keyframes modalIn { from { opacity:0; transform:scale(.92) translateY(16px); } to { opacity:1; transform:scale(1) translateY(0); } }
.modal-image { max-width:90vw; max-height:80vh; object-fit:contain; border-radius:var(--radius); }

/* Calendar / Programmes */
.calendar-event { display:flex; gap:10px; padding:12px; background:var(--bg-card); border-radius:var(--radius-sm); margin-bottom:8px; border-left:3px solid var(--gold); }
.calendar-event .event-date { text-align:center; min-width:45px; }
.calendar-event .event-day { font-size:20px; font-weight:800; color:var(--gold); }
.calendar-event .event-month { font-size:10px; color:var(--text-muted); text-transform:uppercase; }
.calendar-event .event-info h4 { font-size:13px; margin-bottom:2px; }
.calendar-event .event-info p { font-size:11px; color:var(--text-secondary); }

.program-card {
  background: linear-gradient(135deg, rgba(201,162,39,0.1), rgba(124,77,255,0.05));
  border-left: 4px solid var(--gold);
  border-radius: var(--radius-sm);
  padding: 15px;
  margin-bottom: 12px;
}
.program-card .program-title {
  font-size: 16px;
  font-weight: 700;
  color: var(--gold-light);
  margin-bottom: 8px;
}
.program-card .program-time {
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--text-secondary);
  margin-bottom: 4px;
}
.program-card .program-desc {
  font-size: 12px;
  color: var(--text-muted);
}

/* Toast */
.toast-container { position:fixed; top:calc(var(--navbar-height) + 8px); right:12px; z-index:9000; display:flex; flex-direction:column; gap:6px; }
.toast { background:var(--bg-glass); backdrop-filter:blur(20px); border:1px solid var(--border-glass); border-radius:var(--radius-sm); padding:12px 16px; min-width:260px; max-width:340px; animation:toastIn .4s ease; display:flex; align-items:center; gap:8px; font-size:13px; box-shadow:var(--shadow); }
.toast.success { border-left:3px solid var(--success); }
.toast.error { border-left:3px solid var(--danger); }
.toast.info { border-left:3px solid var(--gold); }
@keyframes toastIn { from { opacity:0; transform:translateX(100%); } to { opacity:1; transform:translateX(0); } }

/* Tabs */
.tabs { display:flex; gap:3px; background:var(--bg-card); border-radius:var(--radius-sm); padding:3px; margin-bottom:14px; overflow-x:auto; }
.tab { flex:1; padding:9px 12px; border:none; background:transparent; color:var(--text-muted); border-radius:7px; cursor:pointer; font-size:12px; font-weight:600; transition:var(--transition); white-space:nowrap; }
.tab.active { background:var(--primary); color:white; }
.tab-content { display:none; }
.tab-content.active { display:block; }

/* Empty */
.empty-state { text-align:center; padding:30px 16px; color:var(--text-muted); }
.empty-state .empty-icon { font-size:40px; margin-bottom:10px; }
.empty-state p { font-size:13px; }

/* File Upload */
.file-upload-area { border:2px dashed var(--border-glass); border-radius:var(--radius); padding:24px; text-align:center; cursor:pointer; transition:var(--transition); }
.file-upload-area:hover { border-color:var(--gold); background:rgba(201,162,39,.04); }
.file-upload-area .upload-icon { font-size:32px; margin-bottom:6px; }

/* Toggle */
.settings-item { display:flex; align-items:center; justify-content:space-between; padding:12px 0; border-bottom:1px solid var(--border-glass); }
.settings-label { display:flex; align-items:center; gap:8px; font-size:13px; }
.toggle-switch { position:relative; width:46px; height:24px; }
.toggle-switch input { opacity:0; width:0; height:0; }
.toggle-slider { position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background:var(--bg-card); border-radius:12px; transition:var(--transition); border:1px solid var(--border-glass); }
.toggle-slider:before { content:''; position:absolute; height:18px; width:18px; left:2px; bottom:2px; background:white; border-radius:50%; transition:var(--transition); }
.toggle-switch input:checked + .toggle-slider { background:var(--gold); border-color:var(--gold); }
.toggle-switch input:checked + .toggle-slider:before { transform:translateX(22px); }

.live-photos-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(100px,1fr)); gap:6px; margin-top:10px; }
.live-photo-item { aspect-ratio:1; border-radius:6px; overflow:hidden; }
.live-photo-item img { width:100%; height:100%; object-fit:cover; }

.section-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:14px; }
.section-header h2 { font-size:18px; font-weight:800; }

.hidden { display:none !important; }

/* ====================================
   üßò MEDITATION (identique)
   ==================================== */
.meditation-hero {
  text-align:center; padding:24px 16px;
  background:linear-gradient(135deg, rgba(124,77,255,.15), rgba(179,136,255,.08));
  border-radius:var(--radius); margin-bottom:16px;
  border:1px solid rgba(124,77,255,.2);
  position:relative; overflow:hidden;
}
.meditation-hero::before {
  content:''; position:absolute; top:50%; left:50%;
  width:180px; height:180px;
  background:radial-gradient(circle,rgba(124,77,255,.12),transparent);
  border-radius:50%; transform:translate(-50%,-50%);
  animation:breatheGlow 8s ease-in-out infinite;
}
@keyframes breatheGlow { 0%,100% { transform:translate(-50%,-50%) scale(1); opacity:.3; } 50% { transform:translate(-50%,-50%) scale(1.5); opacity:.6; } }
.meditation-hero h2 { position:relative; z-index:1; font-size:20px; background:linear-gradient(135deg,var(--meditation-light),#ce93d8); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
.meditation-hero p { position:relative; z-index:1; color:var(--text-secondary); font-size:13px; margin-top:4px; }

/* Breathing Circle */
.breathing-container { display:flex; flex-direction:column; align-items:center; padding:24px 16px; }
.breathing-circle-wrapper { position:relative; width:200px; height:200px; margin-bottom:20px; }
.breathing-circle {
  width:200px; height:200px; border-radius:50%;
  background:radial-gradient(circle at 30% 30%,var(--meditation-light),var(--meditation));
  display:flex; align-items:center; justify-content:center;
  font-size:16px; font-weight:700; color:white; text-align:center;
  position:relative; z-index:2;
  box-shadow:0 0 30px rgba(124,77,255,.3);
  transition:transform 4s ease-in-out;
}
.breathing-circle.inhale { transform:scale(1.3); }
.breathing-circle.exhale { transform:scale(.85); }
.breathing-circle.hold { transform:scale(1.3); }
.breathing-ring { position:absolute; top:50%; left:50%; width:240px; height:240px; border:2px solid rgba(124,77,255,.2); border-radius:50%; transform:translate(-50%,-50%); animation:ringPulse 8s ease-in-out infinite; }
.breathing-ring:nth-child(2) { width:270px; height:270px; border-color:rgba(124,77,255,.1); animation-delay:-2s; }
@keyframes ringPulse { 0%,100% { transform:translate(-50%,-50%) scale(1); opacity:.5; } 50% { transform:translate(-50%,-50%) scale(1.1); opacity:1; } }
.breathing-phase { font-size:15px; color:var(--meditation-light); margin-bottom:6px; font-weight:600; min-height:22px; }
.breathing-timer { font-size:44px; font-weight:800; color:var(--text-primary); font-variant-numeric:tabular-nums; }
.breathing-controls { display:flex; gap:10px; margin-top:16px; flex-wrap:wrap; justify-content:center; }

/* Meditation Modes */
.meditation-modes { display:grid; grid-template-columns:repeat(2,1fr); gap:10px; margin-bottom:16px; }
.meditation-mode { background:var(--bg-glass); border:1px solid var(--border-glass); border-radius:var(--radius); padding:14px; cursor:pointer; transition:var(--transition); text-align:center; }
.meditation-mode:hover { border-color:var(--meditation); transform:translateY(-2px); }
.meditation-mode.active { border-color:var(--meditation); background:rgba(124,77,255,.12); }
.meditation-mode .mode-icon { font-size:28px; margin-bottom:6px; }
.meditation-mode .mode-name { font-size:13px; font-weight:700; }
.meditation-mode .mode-desc { font-size:10px; color:var(--text-muted); margin-top:3px; }

.session-info { display:flex; justify-content:space-around; background:var(--bg-card); border-radius:var(--radius-sm); padding:14px; margin-bottom:14px; }
.session-stat { text-align:center; }
.session-stat .ss-value { font-size:18px; font-weight:800; color:var(--meditation-light); }
.session-stat .ss-label { font-size:9px; color:var(--text-muted); text-transform:uppercase; letter-spacing:1px; margin-top:2px; }

/* Ambient */
.ambient-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-bottom:14px; }
.ambient-btn { display:flex; flex-direction:column; align-items:center; gap:5px; padding:12px 8px; background:var(--bg-card); border:1px solid var(--border-glass); border-radius:var(--radius-sm); cursor:pointer; transition:var(--transition); font-size:11px; font-weight:600; color:var(--text-secondary); }
.ambient-btn:hover { border-color:var(--meditation); }
.ambient-btn.active { border-color:var(--meditation); background:rgba(124,77,255,.12); color:var(--meditation-light); }
.ambient-btn .amb-icon { font-size:24px; }

.daily-verse-card { background:linear-gradient(135deg,rgba(201,162,39,.08),rgba(124,77,255,.05)); border:1px solid rgba(201,162,39,.15); border-radius:var(--radius); padding:20px; text-align:center; margin-bottom:14px; }
.daily-verse-card .dv-icon { font-size:32px; margin-bottom:10px; }
.daily-verse-card .dv-text { font-size:15px; font-style:italic; line-height:1.6; color:var(--text-primary); }
.daily-verse-card .dv-ref { font-size:12px; color:var(--gold); font-weight:700; margin-top:8px; }

.volume-control { display:flex; align-items:center; gap:8px; margin-top:6px; }
.volume-control input[type="range"] { flex:1; height:4px; -webkit-appearance:none; background:var(--border-glass); border-radius:2px; outline:none; }
.volume-control input[type="range"]::-webkit-slider-thumb { -webkit-appearance:none; width:16px; height:16px; background:var(--meditation); border-radius:50%; cursor:pointer; }

.med-history-item { display:flex; align-items:center; justify-content:space-between; padding:10px; background:var(--bg-card); border-radius:var(--radius-sm); margin-bottom:6px; }
.med-history-item .mh-info { display:flex; align-items:center; gap:8px; }
.med-history-item .mh-icon { font-size:22px; }
.med-history-item .mh-text h4 { font-size:13px; }
.med-history-item .mh-text p { font-size:10px; color:var(--text-muted); }
.med-history-item .mh-duration { font-size:13px; font-weight:700; color:var(--meditation-light); }

/* Completion */
.completion-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.85); backdrop-filter:blur(10px); display:none; align-items:center; justify-content:center; z-index:6000; flex-direction:column; }
.completion-overlay.show { display:flex; }
.completion-icon { font-size:70px; animation:completeBounce 1s ease; }
@keyframes completeBounce { 0% { transform:scale(0); opacity:0; } 60% { transform:scale(1.3); } 100% { transform:scale(1); opacity:1; } }
.completion-text { font-size:22px; font-weight:700; margin-top:14px; color:var(--gold-light); }
.completion-sub { font-size:13px; color:var(--text-secondary); margin-top:6px; }
.completion-church { font-size:11px; color:var(--text-muted); margin-top:4px; }

/* ====================================
   ABOUT & CONTACT STYLES
   ==================================== */
.about-section, .contact-section, .programs-section {
  background: var(--bg-glass);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border-glass);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 20px;
}
.about-title {
  font-size: 1.4rem;
  color: var(--gold);
  margin-bottom: 15px;
  border-left: 4px solid var(--gold);
  padding-left: 12px;
}
.about-text {
  line-height: 1.7;
  font-size: 14px;
  color: var(--text-secondary);
  white-space: pre-line;
}
.about-text strong {
  color: var(--gold-light);
}
.contact-info {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin: 15px 0;
}
.contact-item {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 14px;
  color: var(--text-primary);
  background: var(--bg-card);
  padding: 12px;
  border-radius: var(--radius-sm);
}
.contact-item .icon {
  font-size: 24px;
  min-width: 30px;
}
.contact-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 20px;
}
.contact-btn {
  flex: 1 1 auto;
  min-width: 120px;
}
.schedule-item {
  background: var(--bg-card);
  border-radius: var(--radius-sm);
  padding: 12px;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 10px;
}
.schedule-item .day {
  font-weight: 700;
  color: var(--gold);
  min-width: 80px;
}
.schedule-item .time {
  color: var(--text-secondary);
}

/* ====================================
   RESPONSIVE
   ==================================== */
@media (max-width:480px) {
  .stats-grid { grid-template-columns:repeat(2,1fr); }
  .quick-actions { grid-template-columns:repeat(3,1fr); }
  .bible-controls { grid-template-columns:1fr; }
  .gallery-grid { grid-template-columns:repeat(3,1fr); }
  .meditation-modes { grid-template-columns:1fr; }
  .breathing-circle-wrapper { width:170px; height:170px; }
  .breathing-circle { width:170px; height:170px; font-size:14px; }
  .breathing-ring { width:210px; height:210px; }
  .breathing-ring:nth-child(2) { width:230px; height:230px; }
}
@media (min-width:768px) {
  .stats-grid { grid-template-columns:repeat(4,1fr); }
}
</style>
</head>
<body>

<div class="bg-animation"><div class="orb"></div><div class="orb"></div><div class="orb"></div></div>

<!-- LOADER -->
<div id="loader">
  <div class="loader-logo">‚úù</div>
  <div class="loader-church-name">CER Ouezzinville Nord<br>Temple Philadelphie</div>
  <div class="loader-church-sub">Application officielle</div>
  <div class="loader-spinner"></div>
</div>

<div class="toast-container" id="toastContainer"></div>

<!-- NAVBAR -->
<nav class="navbar">
  <div class="navbar-brand">
    <div class="logo">‚úù</div>
    <div class="brand-text">
      <div class="brand-name">CER Ouezzinville Nord</div>
      <div class="brand-sub">Temple Philadelphie</div>
    </div>
  </div>
  <div class="navbar-actions">
    <div class="lang-dropdown">
      <button class="nav-btn" onclick="toggleLangMenu()">üåç</button>
      <div class="lang-dropdown-menu" id="langMenu">
        <div class="lang-option" data-lang="fr" onclick="setLanguage('fr')">üá´üá∑ Fran√ßais</div>
        <div class="lang-option" data-lang="en" onclick="setLanguage('en')">üá¨üáß English</div>
        <div class="lang-option" data-lang="dioula" onclick="setLanguage('dioula')">üá≤üá± Dioula</div>
        <div class="lang-option" data-lang="moore" onclick="setLanguage('moore')">üáßüá´ Moor√©</div>
      </div>
    </div>
    <button class="nav-btn" onclick="toggleDarkMode()" id="themeBtn">üåô</button>
    <button class="nav-btn" onclick="showNotifications()">üîî<span class="badge" id="notifBadge" style="display:none">0</span></button>
  </div>
</nav>

<!-- BOTTOM NAV (8 items) -->
<nav class="bottom-nav">
  <button class="bottom-nav-item active" data-page="home" onclick="navigate('home')"><span class="icon">üè†</span><span data-i18n="navHome">Accueil</span></button>
  <button class="bottom-nav-item" data-page="bible" onclick="navigate('bible')"><span class="icon">üìñ</span><span data-i18n="navBible">Bible</span></button>
  <button class="bottom-nav-item" data-page="meditation" onclick="navigate('meditation')"><span class="icon">üßò</span><span data-i18n="navMeditation">M√©diter</span></button>
  <button class="bottom-nav-item" data-page="live" onclick="navigate('live')"><span class="icon">üé•</span><span data-i18n="navLive">Live</span></button>
  <button class="bottom-nav-item" data-page="sermons" onclick="navigate('sermons')"><span class="icon">üé¨</span><span data-i18n="navSermons">Pr√©dica.</span></button>
  <button class="bottom-nav-item" data-page="gallery" onclick="navigate('gallery')"><span class="icon">üñº</span><span data-i18n="navGallery">Galerie</span></button>
  <button class="bottom-nav-item" data-page="programs" onclick="navigate('programs')"><span class="icon">üìÖ</span><span data-i18n="navPrograms">Programmes</span></button>
  <button class="bottom-nav-item" data-page="about" onclick="navigate('about')"><span class="icon">‚ÑπÔ∏è</span><span data-i18n="navAbout">√Ä propos</span></button>
  <button class="bottom-nav-item" data-page="contact" onclick="navigate('contact')"><span class="icon">üìû</span><span data-i18n="navContact">Contact</span></button>
</nav>

<!-- ====================================
     MAIN CONTENT
     ==================================== -->
<main class="main-content">

  <!-- ========== HOME ========== -->
  <div class="page active" id="page-home">
    <div class="welcome-hero">
      <div class="church-logo-large">‚úù</div>
      <h1>CER Ouezzinville Nord</h1>
      <div class="church-full-name" data-i18n="templePhiladelphie">Temple Philadelphie</div>
      <div class="church-verse">
        <span data-i18n="philadelphiaVerse">¬´ Je connais tes ≈ìuvres. Voici, j'ai mis devant toi une porte ouverte, que personne ne peut fermer, parce que tu as peu de puissance, et que tu as gard√© ma parole. ¬ª</span>
        <span class="cv-ref">Apocalypse 3:8</span>
      </div>
    </div>
    <div class="online-bar"><span class="online-dot"></span><span>0</span> <span data-i18n="onlineNow">en ligne</span></div>
    <div class="stats-grid">
      <div class="stat-card"><div class="stat-icon">üì∫</div><div class="stat-value" id="statLives">0</div><div class="stat-label" data-i18n="statLives">Lives</div></div>
      <div class="stat-card"><div class="stat-icon">üë•</div><div class="stat-value" id="statMembers">0</div><div class="stat-label" data-i18n="statMembers">Membres</div></div>
      <div class="stat-card"><div class="stat-icon">üé¨</div><div class="stat-value" id="statSermons">0</div><div class="stat-label" data-i18n="statSermons">Pr√©dications</div></div>
      <div class="stat-card"><div class="stat-icon">üßò</div><div class="stat-value" id="statMeditations">0</div><div class="stat-label" data-i18n="statMeditations">M√©ditations</div></div>
    </div>
    <div class="section-header"><h2 data-i18n="quickActions">Actions rapides</h2></div>
    <div class="quick-actions">
      <div class="quick-action-btn" onclick="navigate('bible')"><span class="qa-icon">üìñ</span><span data-i18n="readBible">Bible</span></div>
      <div class="quick-action-btn" onclick="navigate('meditation')"><span class="qa-icon">üßò</span><span data-i18n="meditate">M√©diter</span></div>
      <div class="quick-action-btn" onclick="navigate('live')"><span class="qa-icon">üé•</span><span data-i18n="watchLive">Lives</span></div>
      <div class="quick-action-btn" onclick="navigate('sermons')"><span class="qa-icon">üé¨</span><span data-i18n="watchSermons">Pr√©dica.</span></div>
      <div class="quick-action-btn" onclick="navigate('gallery')"><span class="qa-icon">üì∏</span><span data-i18n="viewGallery">Galerie</span></div>
      <div class="quick-action-btn" onclick="startQuickMed()"><span class="qa-icon">üåø</span><span data-i18n="quickMeditation">M√©ditation rapide</span></div>
    </div>
    <div class="glass-card" style="margin-top:16px">
      <div class="card-header"><div class="card-title">üìÖ <span data-i18n="upcomingEvents">Prochains cultes</span></div></div>
      <div id="homeEvents"><div class="empty-state"><div class="empty-icon">üìÖ</div><p data-i18n="noEvents">Aucun √©v√©nement programm√©</p></div></div>
    </div>
  </div>

  <!-- ========== BIBLE ========== -->
  <div class="page" id="page-bible">
    <div class="section-header"><h2>üìñ <span data-i18n="bibleTitle">La Bible</span></h2></div>
    <div class="bible-controls">
      <div class="form-group"><label class="form-label" data-i18n="book">Livre</label>
        <select class="form-select" id="bibleBook" onchange="updateChapters();loadBible()">
          <option value="Genesis">Gen√®se</option><option value="Exodus">Exode</option><option value="Leviticus">L√©vitique</option>
          <option value="Numbers">Nombres</option><option value="Deuteronomy">Deut√©ronome</option><option value="Joshua">Josu√©</option>
          <option value="Judges">Juges</option><option value="Ruth">Ruth</option><option value="1 Samuel">1 Samuel</option>
          <option value="2 Samuel">2 Samuel</option><option value="1 Kings">1 Rois</option><option value="2 Kings">2 Rois</option>
          <option value="Psalms">Psaumes</option><option value="Proverbs">Proverbes</option><option value="Isaiah">√âsa√Øe</option>
          <option value="Jeremiah">J√©r√©mie</option><option value="Matthew">Matthieu</option><option value="Mark">Marc</option>
          <option value="Luke">Luc</option><option value="John" selected>Jean</option><option value="Acts">Actes</option>
          <option value="Romans">Romains</option><option value="1 Corinthians">1 Corinthiens</option><option value="Galatians">Galates</option>
          <option value="Ephesians">√âph√©siens</option><option value="Philippians">Philippiens</option><option value="Revelation">Apocalypse</option>
        </select>
      </div>
      <div class="form-group"><label class="form-label" data-i18n="chapter">Chapitre</label><select class="form-select" id="bibleChapter" onchange="loadBible()"></select></div>
      <div class="form-group bible-search"><label class="form-label" data-i18n="search">Recherche</label><input class="form-input" type="text" id="bibleSearch" placeholder="Rechercher..." onkeyup="searchBible()"></div>
    </div>
    <div class="glass-card">
      <div class="bible-audio-controls">
        <button class="btn btn-gold btn-sm" onclick="speakBible()">üîä <span data-i18n="listen">√âcouter</span></button>
        <button class="btn btn-secondary btn-sm" onclick="pauseSpeech()">‚è∏</button>
        <button class="btn btn-secondary btn-sm" onclick="stopSpeech()">‚èπ</button>
        <div class="speed-control"><span>Vitesse:</span><select class="form-select" id="speechSpeed" style="width:65px;padding:5px 6px"><option value="0.5">0.5x</option><option value="0.75">0.75x</option><option value="1" selected>1x</option><option value="1.25">1.25x</option><option value="1.5">1.5x</option></select></div>
      </div>
    </div>
    <div class="bible-content" id="bibleContent"><div class="empty-state"><div class="loader-spinner" style="margin:0 auto 10px"></div><p>Chargement...</p></div></div>
    <div class="tabs" style="margin-top:14px">
      <button class="tab active" onclick="showBibleTab('favorites',this)">‚≠ê Favoris</button>
      <button class="tab" onclick="showBibleTab('history',this)">üìú Historique</button>
    </div>
    <div class="tab-content active" id="bible-tab-favorites"><div id="bibleFavorites"><div class="empty-state"><div class="empty-icon">‚≠ê</div><p data-i18n="noFavorites">Aucun favori</p></div></div></div>
    <div class="tab-content" id="bible-tab-history"><div id="bibleHistory"></div></div>
  </div>

  <!-- ========== MEDITATION ========== -->
  <div class="page" id="page-meditation">
    <div class="meditation-hero">
      <h2 data-i18n="meditationTitle">üßò M√©ditation & Pri√®re</h2>
      <p>Temple Philadelphie ‚Äî <span data-i18n="meditationSubtitle">Trouvez la paix dans Sa pr√©sence</span></p>
    </div>

    <div class="daily-verse-card" id="dailyVerseCard">
      <div class="dv-icon">‚ú®</div>
      <div class="dv-text" id="dailyVerseText">"..."</div>
      <div class="dv-ref" id="dailyVerseRef"></div>
      <button class="btn btn-meditation btn-sm" style="margin-top:10px" onclick="meditateOnVerse()" data-i18n="meditateVerse">M√©diter ce verset</button>
    </div>

    <div class="session-info">
      <div class="session-stat"><div class="ss-value" id="totalMedTime">0</div><div class="ss-label" data-i18n="totalMinutes">min. total</div></div>
      <div class="session-stat"><div class="ss-value" id="totalMedSessions">0</div><div class="ss-label" data-i18n="sessions">sessions</div></div>
      <div class="session-stat"><div class="ss-value" id="medStreak">0</div><div class="ss-label" data-i18n="streak">jours</div></div>
    </div>

    <div class="section-header"><h2 data-i18n="choosePractice">Pratique</h2></div>
    <div class="meditation-modes">
      <div class="meditation-mode active" onclick="selectMedMode('breathing',this)"><div class="mode-icon">üå¨Ô∏è</div><div class="mode-name" data-i18n="breathingMode">Respiration</div><div class="mode-desc" data-i18n="breathingDesc">Inspirez, expirez</div></div>
      <div class="meditation-mode" onclick="selectMedMode('prayer',this)"><div class="mode-icon">üôè</div><div class="mode-name" data-i18n="prayerMode">Pri√®re</div><div class="mode-desc" data-i18n="prayerDesc">Recueillement</div></div>
      <div class="meditation-mode" onclick="selectMedMode('scripture',this)"><div class="mode-icon">üìñ</div><div class="mode-name" data-i18n="scriptureMode">Lectio Divina</div><div class="mode-desc" data-i18n="scriptureDesc">√âcritures</div></div>
      <div class="meditation-mode" onclick="selectMedMode('gratitude',this)"><div class="mode-icon">üíõ</div><div class="mode-name" data-i18n="gratitudeMode">Gratitude</div><div class="mode-desc" data-i18n="gratitudeDesc">Louange</div></div>
    </div>

    <div class="glass-card">
      <div class="card-title" style="margin-bottom:10px">‚è± <span data-i18n="duration">Dur√©e</span></div>
      <div style="display:flex;gap:6px;flex-wrap:wrap;justify-content:center">
        <button class="btn btn-secondary btn-sm dur-btn" onclick="setDur(3,this)">3 min</button>
        <button class="btn btn-meditation btn-sm dur-btn active" onclick="setDur(5,this)">5 min</button>
        <button class="btn btn-secondary btn-sm dur-btn" onclick="setDur(10,this)">10 min</button>
        <button class="btn btn-secondary btn-sm dur-btn" onclick="setDur(15,this)">15 min</button>
        <button class="btn btn-secondary btn-sm dur-btn" onclick="setDur(20,this)">20 min</button>
        <button class="btn btn-secondary btn-sm dur-btn" onclick="setDur(30,this)">30 min</button>
      </div>
    </div>

    <div class="glass-card">
      <div class="card-title" style="margin-bottom:10px">üéµ <span data-i18n="ambientSound">Ambiance</span></div>
      <div class="ambient-grid">
        <div class="ambient-btn" onclick="toggleAmbient('silence',this)"><div class="amb-icon">ü§´</div><span data-i18n="silence">Silence</span></div>
        <div class="ambient-btn" onclick="toggleAmbient('rain',this)"><div class="amb-icon">üåßÔ∏è</div><span data-i18n="rain">Pluie</span></div>
        <div class="ambient-btn" onclick="toggleAmbient('ocean',this)"><div class="amb-icon">üåä</div><span data-i18n="ocean">Oc√©an</span></div>
        <div class="ambient-btn" onclick="toggleAmbient('forest',this)"><div class="amb-icon">üå≤</div><span data-i18n="forest">For√™t</span></div>
        <div class="ambient-btn" onclick="toggleAmbient('fire',this)"><div class="amb-icon">üî•</div><span data-i18n="fireplace">Feu</span></div>
        <div class="ambient-btn" onclick="toggleAmbient('birds',this)"><div class="amb-icon">üê¶</div><span data-i18n="birds">Oiseaux</span></div>
      </div>
      <div class="volume-control"><span>üîà</span><input type="range" min="0" max="100" value="50" id="ambVol" oninput="setAmbVol(this.value)"><span>üîä</span></div>
    </div>

    <!-- Breathing Exercise -->
    <div class="glass-card" id="medActiveArea">
      <div class="breathing-container" id="breathingArea">
        <div class="breathing-phase" id="breathPhase" data-i18n="readyStart">Pr√™t √† commencer</div>
        <div class="breathing-circle-wrapper">
          <div class="breathing-ring"></div><div class="breathing-ring"></div>
          <div class="breathing-circle" id="breathCircle"><span id="breathInstr" data-i18n="pressStart">Appuyez<br>D√©marrer</span></div>
        </div>
        <div class="breathing-timer" id="medTimer">5:00</div>
        <div class="breathing-controls">
          <button class="btn btn-meditation" onclick="startMed()" id="btnStartMed">‚ñ∂Ô∏è <span data-i18n="start">D√©marrer</span></button>
          <button class="btn btn-secondary hidden" onclick="pauseMed()" id="btnPauseMed">‚è∏</button>
          <button class="btn btn-danger btn-sm hidden" onclick="stopMed()" id="btnStopMed">‚èπ</button>
        </div>
      </div>
      <div class="hidden" id="scriptureArea">
        <div style="text-align:center;padding:16px">
          <h3 style="color:var(--meditation-light)" data-i18n="lectioDivina">Lectio Divina</h3>
          <p style="font-size:12px;color:var(--text-secondary);margin:6px 0" data-i18n="lectioDesc">Lisez lentement, laissez le texte vous parler</p>
          <div class="daily-verse-card" style="margin:12px 0"><div class="dv-text" id="scriptureText">"..."</div><div class="dv-ref" id="scriptureRef"></div></div>
          <div class="breathing-timer" id="scriptureTimer">5:00</div>
          <div class="breathing-controls" style="margin-top:12px">
            <button class="btn btn-meditation" onclick="startMed()" id="btnStartS">‚ñ∂Ô∏è</button>
            <button class="btn btn-secondary hidden" onclick="pauseMed()" id="btnPauseS">‚è∏</button>
            <button class="btn btn-danger btn-sm hidden" onclick="stopMed()" id="btnStopS">‚èπ</button>
          </div>
        </div>
      </div>
      <div class="hidden" id="gratitudeArea">
        <div style="text-align:center;padding:16px">
          <h3 style="color:var(--meditation-light)">üíõ <span data-i18n="gratitudeTitle">Gratitude</span></h3>
          <p style="font-size:12px;color:var(--text-secondary);margin:6px 0 14px" data-i18n="gratitudeInst">3 sujets de reconnaissance</p>
          <div class="form-group"><input class="form-input" id="grat1" placeholder="1. Je suis reconnaissant pour..." maxlength="200"></div>
          <div class="form-group"><input class="form-input" id="grat2" placeholder="2. Je suis reconnaissant pour..." maxlength="200"></div>
          <div class="form-group"><input class="form-input" id="grat3" placeholder="3. Je suis reconnaissant pour..." maxlength="200"></div>
          <div class="breathing-timer" id="gratTimer">5:00</div>
          <div class="breathing-controls" style="margin-top:12px">
            <button class="btn btn-meditation" onclick="startMed()" id="btnStartG">‚ñ∂Ô∏è</button>
            <button class="btn btn-secondary hidden" onclick="pauseMed()" id="btnPauseG">‚è∏</button>
            <button class="btn btn-danger btn-sm hidden" onclick="stopMed()" id="btnStopG">‚èπ</button>
          </div>
        </div>
      </div>
    </div>

    <div class="glass-card">
      <div class="card-header"><div class="card-title">üìì <span data-i18n="journal">Journal</span></div></div>
      <div class="form-group"><textarea class="form-textarea" id="medJournal" placeholder="R√©flexions, pri√®res..." style="min-height:90px"></textarea></div>
      <button class="btn btn-meditation btn-sm btn-block" onclick="saveJournal()">üíæ <span data-i18n="saveEntry">Sauvegarder</span></button>
      <div id="journalEntries" style="margin-top:12px"></div>
    </div>

    <div class="glass-card">
      <div class="card-header"><div class="card-title">üìä <span data-i18n="medHistory">Historique</span></div></div>
      <div id="medHistory"></div>
    </div>
  </div>

  <!-- ========== LIVE (enregistrement local) ========== -->
  <div class="page" id="page-live">
    <div class="section-header"><h2>üé• <span data-i18n="liveTitle">Live ‚Äì Enregistrement</span></h2></div>
    <div class="glass-card">
      <h3 data-i18n="createLive">D√©marrer un live (enregistrement)</h3>
      <p style="font-size:12px;color:var(--text-secondary);margin-bottom:10px">Le live est priv√©. √Ä la fin, la vid√©o sera ajout√©e √† la biblioth√®que des pr√©dications.</p>
      <div class="form-group"><label class="form-label">Titre de la pr√©dication</label><input class="form-input" type="text" id="liveTitle" placeholder="Ex: La foi qui sauve" maxlength="100"></div>
      <div class="form-group"><label class="form-label">Description (optionnelle)</label><textarea class="form-textarea" id="liveDesc" maxlength="500"></textarea></div>
      <div class="settings-item" style="border:none;padding:6px 0">
        <div class="settings-label"><span>üî¥</span><span>Enregistrement audio/vid√©o</span></div>
        <label class="toggle-switch"><input type="checkbox" id="enableRec" checked><span class="toggle-slider"></span></label>
      </div>
      <button class="btn btn-gold btn-block" onclick="startLiveRecording()" id="startLiveBtn">üé• D√©marrer le live</button>
    </div>

    <div id="liveRoom" class="hidden">
      <div class="glass-card">
        <div class="card-header">
          <div><div class="live-badge">üî¥ EN DIRECT</div><h3 id="liveRoomTitle" style="margin-top:6px"></h3><p id="liveRoomDesc" style="font-size:12px;color:var(--text-secondary);margin-top:4px"></p></div>
          <button class="btn btn-danger btn-sm" onclick="stopLiveRecording()" id="stopLiveBtn">‚èπ Arr√™ter</button>
        </div>
        <div class="camera-container">
          <video id="livePreview" autoplay playsinline muted style="width:100%; border-radius:var(--radius); background:#000;"></video>
        </div>
        <div style="display:flex; justify-content:center; gap:10px; margin-top:10px;">
          <button class="btn btn-secondary btn-sm" onclick="toggleCamera()" id="btnCam">üîÑ Changer cam√©ra</button>
        </div>
        <div style="margin-top:12px">
          <h4 data-i18n="livePhotos">üì∑ Photos (enregistr√©es dans la galerie)</h4>
          <button class="btn btn-gold btn-sm" onclick="takePhoto()">üì∏ Prendre photo</button>
          <div class="live-photos-grid" id="livePhotosGrid"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== SERMONS ========== -->
  <div class="page" id="page-sermons">
    <div class="section-header"><h2>üé¨ <span data-i18n="sermonsTitle">Pr√©dications</span></h2></div>
    <div class="tabs">
      <button class="tab active" onclick="showSermonTab('videos',this)">üìπ Vid√©os</button>
      <button class="tab" onclick="showSermonTab('youtube',this)">‚ñ∂Ô∏è YouTube</button>
      <button class="tab" onclick="showSermonTab('upload',this)">‚¨ÜÔ∏è Upload</button>
    </div>
    <div class="tab-content active" id="sermon-tab-videos"><div id="sermonsList"><div class="empty-state"><div class="empty-icon">üé¨</div><p data-i18n="noSermons">Aucune pr√©dication</p></div></div></div>
    <div class="tab-content" id="sermon-tab-youtube">
      <div class="glass-card">
        <div class="form-group"><label class="form-label">YouTube URL</label><input class="form-input" type="url" id="ytUrl" placeholder="https://youtube.com/watch?v=..."></div>
        <div class="form-group"><label class="form-label">Titre</label><input class="form-input" type="text" id="ytTitle" maxlength="150"></div>
        <button class="btn btn-gold btn-block" onclick="addYT()">‚ûï Ajouter</button>
      </div><div id="ytList"></div>
    </div>
    <div class="tab-content" id="sermon-tab-upload">
      <div class="glass-card">
        <div class="file-upload-area" onclick="document.getElementById('vidUp').click()"><div class="upload-icon">üé¨</div><p>Cliquer pour s√©lectionner</p><input type="file" id="vidUp" accept="video/*" style="display:none" onchange="handleVidUp(event)"></div>
        <div class="form-group" style="margin-top:10px"><label class="form-label">Titre</label><input class="form-input" type="text" id="vidTitle" maxlength="150"></div>
        <div class="upload-progress hidden" id="vidProg"><div class="upload-progress-bar" id="vidProgBar"></div></div>
        <p class="hidden" id="vidProgTxt" style="font-size:11px;color:var(--text-secondary);text-align:center;margin-top:4px"></p>
      </div>
    </div>
  </div>

  <!-- ========== GALLERY ========== -->
  <div class="page" id="page-gallery">
    <div class="section-header"><h2>üñº <span data-i18n="galleryTitle">Galerie</span></h2>
      <button class="btn btn-gold btn-sm" onclick="document.getElementById('galUp').click()">‚ûï Photo</button>
      <input type="file" id="galUp" accept="image/*" multiple style="display:none" onchange="handleGalUp(event)">
    </div>
    <div class="upload-progress hidden" id="galProg"><div class="upload-progress-bar" id="galProgBar"></div></div>
    <div class="gallery-grid" id="galGrid"><div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">üì∏</div><p data-i18n="noPhotos">Aucune photo</p></div></div>
  </div>

  <!-- ========== PROGRAMS ========== -->
  <div class="page" id="page-programs">
    <div class="section-header"><h2>üìÖ <span data-i18n="programsTitle">Programme des cultes</span></h2></div>
    <div class="programs-section">
      <div class="program-card">
        <div class="program-title" data-i18n="sundayService">Culte du dimanche</div>
        <div class="program-time">‚è∞ 8h00 ‚Äì 11h30</div>
        <div class="program-desc" data-i18n="sundayDesc">Adoration, enseignement biblique, communion fraternelle</div>
      </div>
      <div class="program-card">
        <div class="program-title" data-i18n="wednesdayPrayer">Pri√®re du mercredi</div>
        <div class="program-time">‚è∞ 17h30 ‚Äì 18h30</div>
        <div class="program-desc" data-i18n="wednesdayDesc">Intercession, louange, m√©ditation de la Parole</div>
      </div>
      <div class="program-card">
        <div class="program-title" data-i18n="fridayPrayer">Veill√©e de pri√®re</div>
        <div class="program-time">‚è∞ 21h00 ‚Äì 23h00</div>
        <div class="program-desc" data-i18n="fridayDesc">Louange intense, pri√®re pour les besoins, combat spirituel</div>
      </div>
      <!-- Ajoutez d'autres programmes si n√©cessaire -->
    </div>
  </div>

  <!-- ========== ABOUT ========== -->
  <div class="page" id="page-about">
    <div class="section-header"><h2>‚ÑπÔ∏è <span data-i18n="aboutTitle">√Ä propos de nous</span></h2></div>
    <div class="about-section" id="aboutContent"></div>
  </div>

  <!-- ========== CONTACT ========== -->
  <div class="page" id="page-contact">
    <div class="section-header"><h2>üìû <span data-i18n="contactTitle">Nous contacter</span></h2></div>
    <div class="contact-section">
      <div class="contact-info">
        <div class="contact-item">
          <span class="icon">üìû</span>
          <span>+226 76 75 30 35 (WhatsApp)</span>
        </div>
        <div class="contact-item">
          <span class="icon">üì±</span>
          <span>+226 07 67 18 39</span>
        </div>
        <div class="contact-item">
          <span class="icon">‚úâÔ∏è</span>
          <span>cerouezzinvillenord@gmail.com</span>
        </div>
      </div>
      <div class="contact-buttons">
        <a href="mailto:cerouezzinvillenord@gmail.com?subject=Message%20depuis%20l%27application" class="btn btn-gold contact-btn">üìß Email</a>
        <a href="https://wa.me/22676753035?text=Message%20depuis%20l%27application" target="_blank" class="btn btn-success contact-btn">üí¨ WhatsApp</a>
        <a href="sms:+22676753035?body=Message%20depuis%20l%27application" class="btn btn-secondary contact-btn">üì± SMS</a>
      </div>
      <div style="margin-top: 25px;">
        <h4 data-i18n="serviceTimes">Horaires des cultes</h4>
        <div class="schedule-item">
          <span class="day" data-i18n="sunday">Dimanche</span>
          <span class="time">8h00 ‚Äì 11h30</span>
        </div>
        <div class="schedule-item">
          <span class="day" data-i18n="wednesday">Mercredi</span>
          <span class="time">17h30 ‚Äì 18h30 (pri√®re)</span>
        </div>
        <div class="schedule-item">
          <span class="day" data-i18n="friday">Vendredi</span>
          <span class="time">21h00 ‚Äì 23h00 (pri√®re)</span>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- MODALS -->
<div class="modal-overlay" id="imageZoomModal" onclick="closeModal('imageZoomModal')"><img class="modal-image" id="zoomImg" src="" alt=""></div>
<div class="modal-overlay" id="notifModal">
  <div class="modal-content"><h3 style="margin-bottom:14px">üîî Notifications</h3><div id="notifList"><div class="empty-state"><div class="empty-icon">üîî</div><p>‚Äî</p></div></div><button class="btn btn-secondary btn-block" style="margin-top:14px" onclick="closeModal('notifModal')">Fermer</button></div>
</div>

<!-- Meditation Completion -->
<div class="completion-overlay" id="completionOverlay">
  <div class="completion-icon">üôè</div>
  <div class="completion-text" data-i18n="medComplete">M√©ditation termin√©e</div>
  <div class="completion-sub" id="completionSub"></div>
  <div class="completion-church">‚õ™ CER Ouezzinville Nord ‚Äî Temple Philadelphie</div>
  <button class="btn btn-gold" style="margin-top:20px" onclick="closeCompletion()">‚ú® Amen</button>
</div>

<canvas id="photoCanvas" style="display:none"></canvas>

<script>
// =============================================
// IDENTIT√â DE L'√âGLISE
// =============================================
const CHURCH = {
  name: "CER Ouezzinville Nord",
  temple: "Temple Philadelphie",
  full: "CER Ouezzinville Nord ‚Äî Temple Philadelphie",
  short: "Philadelphie"
};

// =============================================
// CONTENU MULTILINGUE POUR LA PAGE "√Ä PROPOS"
// =============================================
const aboutContent = {
  fr: `√Ä propos de CER Ouezzinville Nord Temple Philadelphie

CER Ouezzinville Nord Temple Philadelphie est une communaut√© chr√©tienne √©vang√©lique √©tablie au Burkina Faso, dans la ville de Bobo-Dioulasso, pr√©cis√©ment √† 500 m√®tres du CEMA de Dafra.

Fond√©e en 2020, l‚Äô√©glise a √©t√© implant√©e avec foi et d√©vouement par le regrett√© Pasteur Sanou, serviteur de Dieu engag√©, qui a rejoint le Seigneur apr√®s avoir pos√© les fondements spirituels de cette ≈ìuvre. Le minist√®re est aujourd‚Äôhui poursuivi sous la conduite du Pasteur Tchonda Mo√Øse, dans la continuit√© de la vision re√ßue et avec un profond attachement aux Saintes √âcritures.

Notre assembl√©e se veut un lieu de pri√®re, d‚Äôadoration, d‚Äôenseignement biblique et d‚Äô√©dification spirituelle, o√π chaque fid√®le est accompagn√© dans sa croissance et son engagement envers Dieu.

Notre Vision

√âlever une g√©n√©ration profond√©ment enracin√©e dans la Parole de Dieu, transform√©e par la puissance du Saint-Esprit et engag√©e dans l‚Äôavancement du Royaume.

Notre Mission

Annoncer fid√®lement l‚Äô√âvangile de J√©sus-Christ
Former des disciples matures et responsables
Consolider les familles dans les principes bibliques
Servir la communaut√© avec amour, int√©grit√© et compassion

Nos Valeurs

La centralit√© de la Parole de Dieu
La pri√®re et la sanctification
L‚Äôunit√© fraternelle
L‚Äôint√©grit√© morale
L‚Äôexcellence dans le service`,
  en: `About CER Ouezzinville Nord Temple Philadelphie

CER Ouezzinville Nord Temple Philadelphie is an evangelical Christian church located in Burkina Faso, in the city of Bobo-Dioulasso, approximately 500 meters from CEMA Dafra.

Established in 2020, the church was founded through faith and dedication by the late Pastor Sanou, a devoted servant of God who went to be with the Lord after laying the spiritual foundations of this ministry. Today, the work continues under the leadership of Pastor Tchonda Mo√Øse, faithfully pursuing the original vision and upholding biblical principles.

Our church is a place of prayer, worship, biblical teaching, and spiritual growth, committed to guiding believers toward maturity in Christ.

Our Vision

To raise a generation firmly grounded in the Word of God, transformed by the power of the Holy Spirit, and committed to advancing God's Kingdom.

Our Mission

To faithfully proclaim the Gospel of Jesus Christ
To train mature and responsible disciples
To strengthen families through biblical principles
To serve the community with love, integrity, and compassion

Our Core Values

The centrality of Scripture
Prayer and holiness
Christian unity
Moral integrity
Excellence in service`,
  dioula: `An ka CER Ouezzinville Nord Temple Philadelphie la

CER Ouezzinville Nord Temple Philadelphie ye eglizi k…õ Burkina Faso, Bobo-Dioulasso la, 500 m…õt…õri k…îf…õ CEMA Dafra.

A b…õ damin…õ san 2020 la ni Pasteur Sanou ye. A tun ye Ala ka baarak…õla min ye ka s…îr…î Ala f…õ. Sisan, Pasteur Tchonda Mo√Øse b…õ baarak…õ ta ni hakili k…õr…õnk…õr…õn ye ka taa f…îl…î ka dalil kan.

Eglizi in ye y…îr…î min b…õ Ala bato, ka Ala kuma kalan, ka d…î…îniw k…õ ka d…î…îniw k…õr…õnk…õr…õn.

N ka hakili (Vision)

Ka denmis…õn d…î…îniw k…õ min b…õ sigi Ala ka kuma kan, ka b…õ…õ ladilan ni Espri Sen ye.

N ka baarak…õ (Mission)

Ka Yesu Kristo ka Kibaru Duman f…î
Ka kalan k…õ ka d…î…îniw k…õr…õnk…õr…õn
Ka denmis…õn ni musow ladilan
Ka jama ladilan ni kanu ye

An ka sariya (Valeurs)

Ala ka kuma ye f…îl…î ye
Seli ni sariyasen
Badenya
Sariyasen ni hakili
Baarak…õ ni betiya ye`,
  moore: `√Ä propos ‚Äì CER Ouezzinville Nord Temple Philadelphie

CER Ouezzinville Nord Temple Philadelphie yaa egliz kristaana Burkina Faso, Bobo-Dioulasso, 500 m√®tre n y…î…îr CEMA Dafra.

Egliz la zemsa 2020 la ni Pasteur Sanou, yamba Wende t…îogo. A taaba Wende nonga, laafi la. S√£ n paasda, Pasteur Tchonda Mo√Øse yaa zemsda ligdi la ne Wende s…îngre.

Egliz la yaa y…î…îr ninga Wende saglga, Wende gomde, ne d√µk√µodga.

Vision

Ka y√£a ninsaalba ninga be Wende gomde la, ne Wende P…îgdb√£ la.

Mission

Ka Yesu Kristo gomde wum
Ka k…©t ninsaalba la
Ka z√£ms ninsaalba ne pagba
Ka zems ninsaalba ne noogo

T√µnd y√£a soay√£

W·∫Ωnnaam gomd√£
W·∫Ωnnaam p ã ãsg la y…©lgr
Ba-biis ne taab t…©…©ma
S…©d la s…©d p ãg·∫Ω
T ã ãmd s·∫Ωn yaa s√µma`
};

// =============================================
// M√âDITATIONS POUR PLUS DE DEUX ANS (730+)
// =============================================
const baseMeditations = [
  { text:"Je connais tes ≈ìuvres. Voici, j'ai mis devant toi une porte ouverte, que personne ne peut fermer.", ref:"Apocalypse 3:8" },
  { text:"Car Dieu a tant aim√© le monde qu'il a donn√© son Fils unique, afin que quiconque croit en lui ne p√©risse point, mais qu'il ait la vie √©ternelle.", ref:"Jean 3:16" },
  { text:"L'√âternel est mon berger : je ne manquerai de rien.", ref:"Psaume 23:1" },
  { text:"Ne crains point, car je suis avec toi ; ne sois point effray√©, car je suis ton Dieu.", ref:"√âsa√Øe 41:10" },
  { text:"Venez √† moi, vous tous qui √™tes fatigu√©s et charg√©s, et je vous donnerai du repos.", ref:"Matthieu 11:28" },
  { text:"Je puis tout par celui qui me fortifie.", ref:"Philippiens 4:13" },
  { text:"Confie-toi en l'√âternel de tout ton c≈ìur.", ref:"Proverbes 3:5" },
  { text:"Car je connais les projets que j'ai form√©s sur vous, projets de paix et non de malheur.", ref:"J√©r√©mie 29:11" },
  { text:"Dieu est notre refuge et notre force, un secours qui ne manque jamais.", ref:"Psaume 46:1" },
  { text:"Soyez toujours joyeux. Priez sans cesse. Rendez gr√¢ces en toutes choses.", ref:"1 Thess. 5:16-18" },
  { text:"J√©sus-Christ est le m√™me hier, aujourd'hui, et √©ternellement.", ref:"H√©breux 13:8" },
  { text:"Aimez-vous les uns les autres ; comme je vous ai aim√©s.", ref:"Jean 15:12" },
  { text:"Tout ce que vous demanderez en mon nom, je le ferai.", ref:"Jean 14:13" },
  { text:"Si Dieu est pour nous, qui sera contre nous ?", ref:"Romains 8:31" },
  { text:"Je vous laisse la paix, je vous donne ma paix.", ref:"Jean 14:27" },
  { text:"Cherchez premi√®rement le royaume et la justice de Dieu.", ref:"Matthieu 6:33" },
  { text:"Je suis le chemin, la v√©rit√©, et la vie.", ref:"Jean 14:6" },
  { text:"Vous √™tes la lumi√®re du monde.", ref:"Matthieu 5:14" },
  { text:"Aimez vos ennemis et priez pour ceux qui vous pers√©cutent.", ref:"Matthieu 5:44" },
  { text:"Ce n'est pas une bonne sant√© qui ont besoin de m√©decin, mais les malades.", ref:"Matthieu 9:12" },
  { text:"La foi est une ferme assurance des choses qu'on esp√®re, une d√©monstration de celles qu'on ne voit pas.", ref:"H√©breux 11:1" },
  { text:"Or la foi vient de ce qu'on entend, et ce qu'on entend vient de la parole de Dieu.", ref:"Romains 10:17" },
  { text:"Nous savons que toutes choses concourent au bien de ceux qui aiment Dieu.", ref:"Romains 8:28" },
  { text:"Que votre lumi√®re luise ainsi devant les hommes.", ref:"Matthieu 5:16" },
  { text:"Heureux ceux qui ont faim et soif de la justice, car ils seront rassasi√©s.", ref:"Matthieu 5:6" },
  { text:"B√©ni soit l'homme qui se confie en l'√âternel.", ref:"J√©r√©mie 17:7" },
  { text:"Demeurez en moi, et je demeurerai en vous.", ref:"Jean 15:4" },
  { text:"Il n'y a de salut dans aucun autre ; car il n'y a sous le ciel aucun autre nom donn√© parmi les hommes, par lequel nous devions √™tre sauv√©s.", ref:"Actes 4:12" },
  { text:"Si quelqu'un est en Christ, il est une nouvelle cr√©ature.", ref:"2 Corinthiens 5:17" },
  { text:"Le fruit de l'Esprit, c'est l'amour, la joie, la paix, la patience, la bont√©, la bienveillance, la foi, la douceur, la ma√Ætrise de soi.", ref:"Galates 5:22-23" },
  { text:"Rev√™tez-vous de l'amour, qui est le lien de la perfection.", ref:"Colossiens 3:14" },
  { text:"Je peux tout par celui qui me fortifie.", ref:"Philippiens 4:13" },
  { text:"Le Seigneur est proche de tous ceux qui l'invoquent.", ref:"Psaume 145:18" },
  { text:"√âloigne-toi du mal, et fais le bien.", ref:"Psaume 34:15" },
  { text:"Que la gr√¢ce du Seigneur J√©sus soit avec tous.", ref:"Apocalypse 22:21" },
  { text:"Car nous sommes son ouvrage, ayant √©t√© cr√©√©s en J√©sus-Christ pour de bonnes ≈ìuvres.", ref:"√âph√©siens 2:10" },
  { text:"Rends-moi la joie de ton salut, et qu'un esprit de bonne volont√© me soutienne.", ref:"Psaume 51:14" },
  { text:"Le nom de l'√âternel est une tour forte ; le juste s'y r√©fugie et se trouve en s√ªret√©.", ref:"Proverbes 18:10" },
  { text:"Dieu est amour, et celui qui demeure dans l'amour demeure en Dieu, et Dieu demeure en lui.", ref:"1 Jean 4:16" },
  { text:"Ne vous inqui√©tez de rien ; mais en toute chose faites conna√Ætre vos besoins √† Dieu.", ref:"Philippiens 4:6" },
  { text:"Heureux l'homme qui supporte patiemment la tentation.", ref:"Jacques 1:12" },
  { text:"Si quelqu'un n'a pas l'Esprit de Christ, il ne lui appartient pas.", ref:"Romains 8:9" },
  { text:"Car la parole de Dieu est vivante et efficace, plus tranchante qu'une √©p√©e quelconque √† deux tranchants.", ref:"H√©breux 4:12" },
  { text:"Approchons-nous donc avec assurance du tr√¥ne de la gr√¢ce, afin d'obtenir mis√©ricorde et de trouver gr√¢ce, pour √™tre secourus dans nos besoins.", ref:"H√©breux 4:16" }
];

// G√©n√©rer 800 m√©ditations en r√©p√©tant la base avec des variations
const dailyVerses = [];
for (let i = 0; i < 800; i++) {
  const base = baseMeditations[i % baseMeditations.length];
  // Ajouter un l√©ger suffixe pour rendre chaque entr√©e unique
  const suffix = i < 365 ? '' : ` (${Math.floor(i/365)+1})`; // pour distinguer les ann√©es
  dailyVerses.push({
    text: base.text + suffix,
    ref: base.ref + suffix
  });
}

// =============================================
// √âTAT GLOBAL
// =============================================
let currentLang = localStorage.getItem('appLang') || 'fr';
let darkMode = localStorage.getItem('darkMode') !== 'false';
let mediaRecorder = null;
let recordedChunks = [];
let cameraStream = null;
let currentCameraFacing = 'user';
let blobUrls = [];

// M√©ditation
let medMode = 'breathing', medDur = 5, medRemaining = 300;
let medInterval = null, medRunning = false, medPaused = false;
let breathPhase = 0, breathTimeout = null;
let currentAmb = null, audioCtx = null, ambGain = null, ambNode = null;
const breathPatterns = { breathing:[4,4,4,4], prayer:[4,7,8,0], scripture:[5,3,5,3], gratitude:[4,2,6,2] };

// =============================================
// TRADUCTIONS (ajout des nouvelles cl√©s)
// =============================================
const T = {
  fr: {
    navHome:"Accueil", navBible:"Bible", navLive:"Live", navSermons:"Pr√©dica.", navGallery:"Galerie", navMeditation:"M√©diter",
    navAbout:"√Ä propos", navContact:"Contact", navPrograms:"Programmes",
    templePhiladelphie:"Temple Philadelphie", philadelphiaVerse:"¬´ Je connais tes ≈ìuvres. Voici, j'ai mis devant toi une porte ouverte... ¬ª",
    onlineNow:"en ligne", statLives:"Lives", statMembers:"Membres", statSermons:"Pr√©dications", statMeditations:"M√©ditations",
    quickActions:"Actions rapides", readBible:"Bible", meditate:"M√©diter", watchLive:"Lives", watchSermons:"Pr√©dica.", viewGallery:"Galerie",
    quickMeditation:"M√©ditation rapide", upcomingEvents:"Prochains cultes", noEvents:"Aucun culte programm√©", bibleTitle:"La Bible",
    book:"Livre", chapter:"Chapitre", search:"Recherche", listen:"√âcouter", noFavorites:"Aucun favori", liveTitle:"Live ‚Äì Enregistrement",
    createLive:"D√©marrer un live", currentLives:"En cours", scheduledLives:"Programm√©s", calendar:"Calendrier", noLives:"Aucun live",
    noScheduled:"Aucun programm√©", leave:"Quitter", participants:"participants", reactions:"R√©actions", liveCamera:"Cam√©ra",
    enableCamera:"Activer", disableCamera:"D√©sactiver", livePhotos:"Photos du Live", chat:"Chat", sermonsTitle:"Pr√©dications",
    noSermons:"Aucune pr√©dication", galleryTitle:"Galerie", noPhotos:"Aucune photo", create:"Cr√©er", cancel:"Annuler",
    copiedVerse:"Copi√© !", addedFavorite:"Favori ajout√© !", removedFavorite:"Favori retir√©", photoSaved:"Photo sauvegard√©e !",
    liveCreated:"Live cr√©√© !", sermonAdded:"Pr√©dication ajout√©e !", uploadComplete:"Upload termin√© !", error:"Erreur",
    spamWarning:"Patientez...", joinLive:"Rejoindre", endLive:"Terminer", days:"j", hours:"h", minutes:"min", seconds:"s",
    start:"D√©marrer", pause:"Pause", stop:"Arr√™ter", meditationTitle:"üßò M√©ditation & Pri√®re", meditationSubtitle:"Trouvez la paix dans Sa pr√©sence",
    meditateVerse:"M√©diter ce verset", totalMinutes:"min. total", sessions:"sessions", streak:"jours", choosePractice:"Pratique",
    breathingMode:"Respiration", breathingDesc:"Inspirez, expirez", prayerMode:"Pri√®re", prayerDesc:"Recueillement",
    scriptureMode:"Lectio Divina", scriptureDesc:"√âcritures", gratitudeMode:"Gratitude", gratitudeDesc:"Louange", duration:"Dur√©e",
    ambientSound:"Ambiance", silence:"Silence", rain:"Pluie", ocean:"Oc√©an", forest:"For√™t", fireplace:"Feu", birds:"Oiseaux",
    readyStart:"Pr√™t √† commencer", pressStart:"Appuyez<br>D√©marrer", inhale:"Inspirez...", holdBreath:"Retenez...", exhale:"Expirez...",
    journal:"Journal", saveEntry:"Sauvegarder", medHistory:"Historique", medComplete:"M√©ditation termin√©e", noMedHistory:"Aucune session",
    entrySaved:"Sauvegard√© !", lectioDivina:"Lectio Divina", lectioDesc:"Lisez lentement", gratitudeTitle:"Gratitude",
    gratitudeInst:"3 sujets de reconnaissance",
    aboutTitle:"√Ä propos de nous", contactTitle:"Nous contacter",
    programsTitle:"Programme des cultes",
    sundayService:"Culte du dimanche", sundayDesc:"Adoration, enseignement biblique, communion fraternelle",
    wednesdayPrayer:"Pri√®re du mercredi", wednesdayDesc:"Intercession, louange, m√©ditation de la Parole",
    fridayPrayer:"Veill√©e de pri√®re", fridayDesc:"Louange intense, pri√®re pour les besoins, combat spirituel",
    serviceTimes:"Horaires des cultes", sunday:"Dimanche", wednesday:"Mercredi", friday:"Vendredi"
  },
  en: {
    navHome:"Home", navBible:"Bible", navLive:"Live", navSermons:"Sermons", navGallery:"Gallery", navMeditation:"Meditate",
    navAbout:"About", navContact:"Contact", navPrograms:"Programs",
    templePhiladelphie:"Temple Philadelphia", philadelphiaVerse:'"I know your works..."', onlineNow:"online", statLives:"Lives",
    statMembers:"Members", statSermons:"Sermons", statMeditations:"Meditations", quickActions:"Quick Actions", readBible:"Bible",
    meditate:"Meditate", watchLive:"Lives", watchSermons:"Sermons", viewGallery:"Gallery", quickMeditation:"Quick meditation",
    upcomingEvents:"Upcoming Services", noEvents:"No events", bibleTitle:"The Bible", book:"Book", chapter:"Chapter", search:"Search",
    listen:"Listen", noFavorites:"No favorites", liveTitle:"Live Recording", createLive:"Start Live", noLives:"No live",
    noScheduled:"None scheduled", leave:"Leave", participants:"participants", reactions:"Reactions", liveCamera:"Camera",
    enableCamera:"Enable", disableCamera:"Disable", livePhotos:"Live Photos", chat:"Chat", sermonsTitle:"Sermons", noSermons:"No sermons",
    galleryTitle:"Gallery", noPhotos:"No photos", create:"Create", cancel:"Cancel", copiedVerse:"Copied!", addedFavorite:"Added!",
    removedFavorite:"Removed", photoSaved:"Photo saved!", liveCreated:"Live created!", sermonAdded:"Sermon added!", uploadComplete:"Upload done!",
    error:"Error", spamWarning:"Wait...", joinLive:"Join", endLive:"End", days:"d", hours:"h", minutes:"min", seconds:"s",
    start:"Start", pause:"Pause", stop:"Stop", meditationTitle:"üßò Meditation & Prayer", meditationSubtitle:"Find peace in His presence",
    meditateVerse:"Meditate this verse", totalMinutes:"total min", sessions:"sessions", streak:"days", choosePractice:"Practice",
    breathingMode:"Breathing", breathingDesc:"Breathe in rhythm", prayerMode:"Prayer", prayerDesc:"Quiet time", scriptureMode:"Lectio Divina",
    scriptureDesc:"Scriptures", gratitudeMode:"Gratitude", gratitudeDesc:"Praise", duration:"Duration", ambientSound:"Ambient",
    silence:"Silence", rain:"Rain", ocean:"Ocean", forest:"Forest", fireplace:"Fire", birds:"Birds", readyStart:"Ready",
    pressStart:"Press<br>Start", inhale:"Breathe in...", holdBreath:"Hold...", exhale:"Breathe out...", journal:"Journal",
    saveEntry:"Save", medHistory:"History", medComplete:"Meditation complete", noMedHistory:"No sessions", entrySaved:"Saved!",
    lectioDivina:"Lectio Divina", lectioDesc:"Read slowly", gratitudeTitle:"Gratitude", gratitudeInst:"3 things you're thankful for",
    aboutTitle:"About us", contactTitle:"Contact us",
    programsTitle:"Service Schedule",
    sundayService:"Sunday Service", sundayDesc:"Worship, Bible teaching, fellowship",
    wednesdayPrayer:"Wednesday Prayer", wednesdayDesc:"Intercession, praise, meditation",
    fridayPrayer:"Friday Prayer Vigil", fridayDesc:"Intense praise, prayer needs, spiritual warfare",
    serviceTimes:"Service times", sunday:"Sunday", wednesday:"Wednesday", friday:"Friday"
  },
  dioula: {
    navHome:"Sof…õ", navBible:"Kitabu", navLive:"Tele", navSermons:"Lasiri", navGallery:"Foto", navMeditation:"Miiri",
    navAbout:"K…îf…õ", navContact:"Kungn…îng…î", navPrograms:"Seli waati",
    templePhiladelphie:"Filadelifiya Bato So", philadelphiaVerse:'"N b…õ i ka baara l…în..."', onlineNow:"b…õ yen",
    readBible:"Kitabu", meditate:"Miiri", watchLive:"Tele", watchSermons:"Lasiri", viewGallery:"Fotow", quickMeditation:"Miiri kacl…õ",
    noEvents:"Ko si t…õ", bibleTitle:"Kitabu", book:"Gaf…õ", chapter:"Kun", search:"∆ùini", listen:"Lam…õ",
    noFavorites:"N fari si t…õ", liveTitle:"Tele", createLive:"Tele damina", noLives:"Tele si t…õ",
    noScheduled:"Ko si t…õ min b…õ na", leave:"B…î", participants:"m…îg…îw", reactions:"Y…õl…õma", liveCamera:"Kamera",
    enableCamera:"Kamera damina", disableCamera:"Kamera laban", livePhotos:"Fotow", chat:"Baro", sermonsTitle:"Lasiriw",
    noSermons:"Lasiri si t…õ", galleryTitle:"Fotow", noPhotos:"Foto si t…õ", create:"Damin…õ", cancel:"M…în", copiedVerse:"Kopya !",
    addedFavorite:"N fari y…õ!", removedFavorite:"N fari b…îra!", photoSaved:"Foto marala!", liveCreated:"Tele damin…õra!",
    sermonAdded:"Lasiri fara a kan!", uploadComplete:"Banna!", error:"Fili", spamWarning:"Maka...", joinLive:"Don",
    endLive:"Bannya", days:"d", hours:"h", minutes:"mn", seconds:"s", start:"Damin…õ", pause:"L…î", stop:"Bannya",
    meditationTitle:"Miiri", meditationSubtitle:"H…õr…õ s…îr…î", meditateVerse:"Miiri kun", totalMinutes:"d…î…înin", sessions:"k…õlen", streak:"don",
    choosePractice:"Kalan", breathingMode:"Fiy…õn", breathingDesc:"Fiy…õn ta, b…î", prayerMode:"Seli", prayerDesc:"D…î…înin",
    scriptureMode:"Gaf…õ kalan", scriptureDesc:"Gaf…õ", gratitudeMode:"Bato", gratitudeDesc:"Bato", duration:"Waati",
    ambientSound:"Fiy…õn", silence:"Dondoli", rain:"Sanji", ocean:"Baji", forest:"Tugu", fireplace:"Tasuma", birds:"K…în…îw",
    readyStart:"S…õg…õn", pressStart:"Damin…õ", inhale:"Fiy…õn don...", holdBreath:"A mara...", exhale:"Fiy…õn b…î...",
    journal:"Gaf…õ", saveEntry:"Mara", medHistory:"K…õlen", medComplete:"Miiri banna", noMedHistory:"Miiri si t…õ", entrySaved:"Marala!",
    lectioDivina:"Gaf…õ kalan", lectioDesc:"Kalan d…î…înin d…î…înin", gratitudeTitle:"Bato", gratitudeInst:"3 ko",
    aboutTitle:"K…îf…õ", contactTitle:"Kungn…îng…î",
    programsTitle:"Seli waati",
    sundayService:"Dimanche seli", sundayDesc:"Bato, Gaf…õ kalan, d…î…înin",
    wednesdayPrayer:"Mercredi seli", wednesdayDesc:"Seli, d…î…înin",
    fridayPrayer:"Vendredi seli", fridayDesc:"Seli, d…î…înin",
    serviceTimes:"Seli waati", sunday:"Dimanche", wednesday:"Mercredi", friday:"Vendredi"
  },
  moore: {
    navHome:"R·∫Ωem", navBible:"Biibl", navLive:"V…©…©r", navSermons:"Paab", navGallery:"Fotos", navMeditation:"Tags",
    navAbout:"Zƒ©ri", navContact:"Gomde", navPrograms:"T ã ãm wakate",
    templePhiladelphie:"Filadelifiya W·∫Ωnd Doog", philadelphiaVerse:'"Mam mii fo t ã ãma..."', onlineNow:"be mas√£",
    readBible:"Biibl", meditate:"Tags", watchLive:"V…©…©r", watchSermons:"Paab", viewGallery:"Fotos", quickMeditation:"Tags kela",
    noEvents:"T ã ãm ka be", bibleTitle:"Biibl", book:"Gaf", chapter:"K√£sem", search:"Bao", listen:"Kelm",
    noFavorites:"Nongr ka be", liveTitle:"V…©…©r", createLive:"V…©…©r s…©ng", noLives:"V…©…©r ka be",
    noScheduled:"B s·∫Ωn na n wa ka be", leave:"B…ëse", participants:"neb", reactions:"T ã ãm", liveCamera:"Kamera",
    enableCamera:"Kamera s…©ng", disableCamera:"Kamera b…ëse", livePhotos:"Fotos", chat:"Gomde", sermonsTitle:"Paab",
    noSermons:"Paab ka be", galleryTitle:"Fotos", noPhotos:"Fotos ka be", create:"S…©ng", cancel:"B…ëse", copiedVerse:"Kopa !",
    addedFavorite:"Mam nonga!", removedFavorite:"B…ëse", photoSaved:"Foto b…ëse!", liveCreated:"V…©…©r s…©nga!",
    sermonAdded:"Paab f…ë…ër a zugu!", uploadComplete:"B…ëse!", error:"T ã ãm ka t…ë", spamWarning:"M…ë…ën...", joinLive:"K·∫Ω",
    endLive:"B…ëse", days:"d", hours:"h", minutes:"mn", seconds:"s", start:"S…©ng", pause:"L…ë…ë", stop:"B…ëse",
    meditationTitle:"Tags", meditationSubtitle:"Laaf…© b…ëo", meditateVerse:"Tags goam", totalMinutes:"min", sessions:"s…õ…õs", streak:"r…ë…ëre",
    choosePractice:"Y√£a", breathingMode:"V ã ãsem", breathingDesc:"V ã ãse, yiis", prayerMode:"P ã ãs", prayerDesc:"Y√µk", scriptureMode:"Gaf k…ërem",
    scriptureDesc:"Gaf ã", gratitudeMode:"P·∫Ωgre", gratitudeDesc:"P·∫Ωgr", duration:"Wakat", ambientSound:"V ã ãsem",
    silence:"Y√µk", rain:"S…ë…ëg…ë", ocean:"M…ë…ës", forest:"W·∫Ωoogo", fireplace:"Bugum", birds:"Liiya", readyStart:"SŒµk",
    pressStart:"S…©ng", inhale:"V ã ãse...", holdBreath:"T√µe...", exhale:"Yiis...",
    journal:"Gaf ã", saveEntry:"Bƒ©ng", medHistory:"K…ëren", medComplete:"Tagsg…ë s…ë…ëm…õ", noMedHistory:"Tags wakat ka be", entrySaved:"Bƒ©ng…ë!",
    lectioDivina:"Gaf k…ërem", lectioDesc:"K…ërem sŒµŒµf…ë", gratitudeTitle:"P·∫Ωgr", gratitudeInst:"YŒµl 3",
    aboutTitle:"T√µnd yŒµla", contactTitle:"Gomde t√µnd neng·∫Ω",
    programsTitle:"T ã ãm wakate",
    sundayService:"Dimanche t ã ãm", sundayDesc:"W·∫Ωnd p·∫Ωgre, Gaf karengre",
    wednesdayPrayer:"Mercredi p ã ãsg", wednesdayDesc:"P ã ãsg, W·∫Ωnd p·∫Ωgre",
    fridayPrayer:"Vendredi p ã ãsg", fridayDesc:"P ã ãsg, t ã ãmd nins",
    serviceTimes:"T ã ãm wakate", sunday:"Dimanche", wednesday:"Mercredi", friday:"Vendredi"
  }
};

// =============================================
// INIT
// =============================================
document.addEventListener('DOMContentLoaded', async () => {
  currentLang = localStorage.getItem('appLang') || 'fr';
  darkMode = localStorage.getItem('darkMode') !== 'false';
  if (!darkMode) { document.body.classList.add('light-mode'); document.getElementById('themeBtn').textContent = '‚òÄÔ∏è'; }
  applyT(); updateLangMenu();
  renderAboutPage();

  updateChapters(); loadBible(); loadDailyVerse(); loadMedStats(); loadMedHist(); loadJournalEntries();
  await loadSermonsFromDB();
  loadGalleryFromStorage();
  setTimeout(() => document.getElementById('loader').classList.add('hidden'), 1400);
  regSW();
});

// =============================================
// FONCTIONS UTILITAIRES
// =============================================
function escapeHtml(unsafe) {
  return unsafe.replace(/[&<>"']/g, function(m) {
    if (m === '&') return '&amp;';
    if (m === '<') return '&lt;';
    if (m === '>') return '&gt;';
    if (m === '"') return '&quot;';
    if (m === "'") return '&#039;';
    return m;
  });
}

function applyT() {
  const t = T[currentLang] || T.fr;
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (t[key]) el.innerHTML = t[key];
  });
}
function tr(k) { return (T[currentLang] || T.fr)[k] || k; }
function setLanguage(l) {
  currentLang = l;
  localStorage.setItem('appLang', l);
  applyT(); updateLangMenu(); closeLangMenu();
  renderAboutPage();
  showToast('‚úÖ', tr('appName'), 'success');
}
function toggleLangMenu() { document.getElementById('langMenu').classList.toggle('show'); }
function closeLangMenu() { document.getElementById('langMenu').classList.remove('show'); }
function updateLangMenu() {
  document.querySelectorAll('.lang-option').forEach(o => o.classList.toggle('active', o.dataset.lang === currentLang));
}
document.addEventListener('click', e => { if (!e.target.closest('.lang-dropdown')) closeLangMenu(); });
function toggleDarkMode() {
  darkMode = !darkMode;
  document.body.classList.toggle('light-mode', !darkMode);
  document.getElementById('themeBtn').textContent = darkMode ? 'üåô' : '‚òÄÔ∏è';
  localStorage.setItem('darkMode', darkMode);
}
function navigate(p) {
  document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
  document.querySelectorAll('.bottom-nav-item').forEach(x => x.classList.remove('active'));
  document.getElementById('page-' + p)?.classList.add('active');
  document.querySelector(`.bottom-nav-item[data-page="${p}"]`)?.classList.add('active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
function startQuickMed() { navigate('meditation'); setDur(3, null); setTimeout(() => startMed(), 300); }
function showToast(icon, msg, type = 'info') {
  const c = document.getElementById('toastContainer'),
    el = document.createElement('div');
  el.className = `toast ${type}`;
  el.innerHTML = `<span>${icon}</span><span>${escapeHtml(msg)}</span>`;
  c.appendChild(el);
  setTimeout(() => {
    el.style.opacity = '0';
    el.style.transform = 'translateX(100%)';
    setTimeout(() => el.remove(), 300);
  }, 3500);
}
let notifs = [];
function showNotifications() { document.getElementById('notifModal').classList.add('show'); renderNotifs(); }
function addNotif(i, m) {
  notifs.unshift({ icon: i, message: m, time: new Date() });
  if (notifs.length > 50) notifs.pop();
  const b = document.getElementById('notifBadge');
  b.textContent = parseInt(b.textContent || '0') + 1;
  b.style.display = 'flex';
  showToast(i, m, 'info');
}
function renderNotifs() {
  const c = document.getElementById('notifList');
  c.innerHTML = notifs.length ? notifs.map(n =>
    `<div class="calendar-event"><div class="event-date" style="min-width:36px;font-size:22px">${escapeHtml(n.icon)}</div><div class="event-info"><h4>${escapeHtml(n.message)}</h4><p>${escapeHtml(timeAgo(n.time))}</p></div></div>`
  ).join('') : '<div class="empty-state"><p>‚Äî</p></div>';
}
function timeAgo(d) {
  const s = Math.floor((new Date() - new Date(d)) / 1000);
  if (s < 60) return 'now';
  if (s < 3600) return Math.floor(s / 60) + 'm';
  if (s < 86400) return Math.floor(s / 3600) + 'h';
  return Math.floor(s / 86400) + 'j';
}
function closeModal(id) { document.getElementById(id).classList.remove('show'); }
document.querySelectorAll('.modal-overlay').forEach(m => m.addEventListener('click', function (e) { if (e.target === this) this.classList.remove('show'); }));
document.addEventListener('keydown', e => { if (e.key === 'Escape') document.querySelectorAll('.modal-overlay.show').forEach(m => m.classList.remove('show')); });

// =============================================
// PAGE √Ä PROPOS
// =============================================
function renderAboutPage() {
  const aboutDiv = document.getElementById('aboutContent');
  const content = aboutContent[currentLang] || aboutContent.fr;
  aboutDiv.innerHTML = `<div class="about-text">${content.replace(/\n/g, '<br>')}</div>`;
}

// =============================================
// üìñ BIBLE (identique)
// =============================================
const BC = {
  Genesis: 50, Exodus: 40, Leviticus: 27, Numbers: 36, Deuteronomy: 34, Joshua: 24, Judges: 21, Ruth: 4,
  '1 Samuel': 31, '2 Samuel': 24, '1 Kings': 22, '2 Kings': 25, Psalms: 150, Proverbs: 31, Isaiah: 66,
  Jeremiah: 52, Matthew: 28, Mark: 16, Luke: 24, John: 21, Acts: 28, Romans: 16, '1 Corinthians': 16,
  Galatians: 6, Ephesians: 6, Philippians: 4, Revelation: 22
};
let bCache = {};
function updateChapters() {
  const b = document.getElementById('bibleBook').value,
    s = document.getElementById('bibleChapter');
  s.innerHTML = '';
  for (let i = 1; i <= (BC[b] || 50); i++) s.innerHTML += `<option value="${i}">${i}</option>`;
}
async function loadBible() {
  const b = document.getElementById('bibleBook').value,
    c = document.getElementById('bibleChapter').value,
    ref = `${b} ${c}`,
    el = document.getElementById('bibleContent');
  el.innerHTML = '<div class="empty-state"><div class="loader-spinner" style="margin:0 auto 8px"></div></div>';
  if (bCache[ref]) { renderVerses(bCache[ref], ref); saveBHist(ref); return; }
  try {
    const r = await fetch(`https://bible-api.com/${encodeURIComponent(ref)}?translation=kjv`);
    if (!r.ok) throw 0;
    const d = await r.json();
    bCache[ref] = d;
    if (Object.keys(bCache).length > 50) delete bCache[Object.keys(bCache)[0]];
    renderVerses(d, ref);
    saveBHist(ref);
  } catch (e) {
    el.innerHTML = '<div class="empty-state"><p>‚ö†Ô∏è Erreur</p><button class="btn btn-gold btn-sm" style="margin-top:8px" onclick="loadBible()">üîÑ</button></div>';
  }
}
function renderVerses(d, ref) {
  const el = document.getElementById('bibleContent');
  if (!d.verses?.length) { el.innerHTML = '<div class="empty-state"><p>‚Äî</p></div>'; return; }
  el.innerHTML = `<div style="margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid var(--border-glass)"><strong style="color:var(--gold)">${escapeHtml(d.reference)}</strong><span style="font-size:10px;color:var(--text-muted);margin-left:6px">‚õ™ ${CHURCH.short}</span></div>` +
    d.verses.map(v => `<div class="verse" onclick="this.style.background='rgba(201,162,39,.1)';setTimeout(()=>this.style.background='',500)"><span class="verse-number">${v.verse}</span>${escapeHtml(v.text)} <span style="font-size:11px;cursor:pointer;opacity:.4" onclick="event.stopPropagation();copyV('${escapeHtml(d.reference)}:${v.verse}','${escapeHtml(v.text)}')">üìã</span> <span style="font-size:11px;cursor:pointer;opacity:.4" onclick="event.stopPropagation();shareV('${escapeHtml(d.reference)}:${v.verse}','${escapeHtml(v.text)}')">üì§</span> <span style="font-size:11px;cursor:pointer;opacity:.4" onclick="event.stopPropagation();toggleFav('${escapeHtml(d.reference)}:${v.verse}','${escapeHtml(v.text)}')">‚≠ê</span></div>`).join('');
}
function copyV(r, t) { navigator.clipboard.writeText(`${r} ‚Äî ${t}\n‚õ™ ${CHURCH.full}`).then(() => showToast('üìã', tr('copiedVerse'), 'success')); }
function shareV(r, t) { if (navigator.share) navigator.share({ title: r, text: `${r} ‚Äî ${t}\n‚õ™ ${CHURCH.full}` }).catch(() => {}); else copyV(r, t); }
function saveBHist(r) {
  let h = JSON.parse(localStorage.getItem('bHist') || '[]');
  h = h.filter(x => x !== r);
  h.unshift(r);
  if (h.length > 30) h = h.slice(0, 30);
  localStorage.setItem('bHist', JSON.stringify(h));
  renderBHist();
}
function renderBHist() {
  const c = document.getElementById('bibleHistory'),
    h = JSON.parse(localStorage.getItem('bHist') || '[]');
  c.innerHTML = h.length ? h.map(x => `<div class="favorite-item" style="cursor:pointer" onclick="loadBRef('${escapeHtml(x)}')">üìñ ${escapeHtml(x)}</div>`).join('') : '<div class="empty-state"><p>‚Äî</p></div>';
}
function loadBRef(r) {
  const p = r.split(' '), c = p.pop(), b = p.join(' ');
  document.getElementById('bibleBook').value = b;
  updateChapters();
  document.getElementById('bibleChapter').value = c;
  loadBible();
}
function searchBible() {
  const q = document.getElementById('bibleSearch').value.toLowerCase();
  document.querySelectorAll('#bibleContent .verse').forEach(v => {
    const t = v.textContent.toLowerCase();
    v.style.display = q && !t.includes(q) ? 'none' : '';
    v.style.background = q && t.includes(q) ? 'rgba(201,162,39,.12)' : '';
  });
}
function showBibleTab(t, b) {
  document.querySelectorAll('#page-bible .tab').forEach(x => x.classList.remove('active'));
  document.querySelectorAll('#page-bible .tab-content').forEach(x => x.classList.remove('active'));
  b.classList.add('active');
  document.getElementById('bible-tab-' + t).classList.add('active');
  if (t === 'history') renderBHist();
  if (t === 'favorites') renderFavs();
}
function renderFavs() {
  const favs = JSON.parse(localStorage.getItem('bibleFavs') || '[]');
  const c = document.getElementById('bibleFavorites');
  c.innerHTML = favs.length ? favs.map(f => `<div class="favorite-item"><div><strong style="color:var(--gold)">${escapeHtml(f.ref)}</strong><p style="font-size:11px;color:var(--text-secondary)">${escapeHtml(f.text.substring(0,70))}...</p></div><button class="btn btn-danger btn-sm" onclick="removeFav('${escapeHtml(f.ref)}')">üóë</button></div>`).join('') : `<div class="empty-state"><p>${tr('noFavorites')}</p></div>`;
}
function toggleFav(ref, text) {
  let favs = JSON.parse(localStorage.getItem('bibleFavs') || '[]');
  const index = favs.findIndex(f => f.ref === ref);
  if (index !== -1) {
    favs.splice(index, 1);
    showToast('‚≠ê', tr('removedFavorite'), 'info');
  } else {
    favs.unshift({ ref, text, date: new Date().toISOString() });
    showToast('‚≠ê', tr('addedFavorite'), 'success');
  }
  localStorage.setItem('bibleFavs', JSON.stringify(favs));
  renderFavs();
}
window.removeFav = function(ref) {
  let favs = JSON.parse(localStorage.getItem('bibleFavs') || '[]');
  favs = favs.filter(f => f.ref !== ref);
  localStorage.setItem('bibleFavs', JSON.stringify(favs));
  renderFavs();
  showToast('‚≠ê', tr('removedFavorite'), 'info');
};
function speakBible() {
  stopSpeech();
  const c = document.getElementById('bibleContent').textContent;
  if (!c) return;
  const u = new SpeechSynthesisUtterance(c);
  u.rate = parseFloat(document.getElementById('speechSpeed').value);
  u.lang = 'fr-FR';
  window.speechSynthesis.speak(u);
}
function pauseSpeech() {
  if (window.speechSynthesis.speaking) {
    if (window.speechSynthesis.paused) window.speechSynthesis.resume();
    else window.speechSynthesis.pause();
  }
}
function stopSpeech() { window.speechSynthesis.cancel(); }

// =============================================
// üßò MEDITATION (avec tableau √©tendu)
// =============================================
function loadDailyVerse() {
  const dayIndex = Math.floor(Date.now() / (1000 * 60 * 60 * 24)) % dailyVerses.length;
  const v = dailyVerses[dayIndex];
  document.getElementById('dailyVerseText').textContent = `"${v.text}"`;
  document.getElementById('dailyVerseRef').textContent = v.ref;
  document.getElementById('scriptureText').textContent = `"${v.text}"`;
  document.getElementById('scriptureRef').textContent = v.ref;
}
function selectMedMode(m, el) {
  medMode = m;
  document.querySelectorAll('.meditation-mode').forEach(x => x.classList.remove('active'));
  if (el) el.classList.add('active');
  document.getElementById('breathingArea').classList.toggle('hidden', m === 'scripture' || m === 'gratitude');
  document.getElementById('scriptureArea').classList.toggle('hidden', m !== 'scripture');
  document.getElementById('gratitudeArea').classList.toggle('hidden', m !== 'gratitude');
  updTimerDisp();
}
function setDur(m, b) {
  medDur = m;
  medRemaining = m * 60;
  document.querySelectorAll('.dur-btn').forEach(x => {
    x.classList.remove('btn-meditation');
    x.classList.add('btn-secondary');
  });
  if (b) {
    b.classList.remove('btn-secondary');
    b.classList.add('btn-meditation');
  }
  updTimerDisp();
}
function updTimerDisp() {
  const m = Math.floor(medRemaining / 60),
    s = medRemaining % 60,
    d = `${m}:${s.toString().padStart(2, '0')}`;
  ['medTimer', 'scriptureTimer', 'gratTimer'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.textContent = d;
  });
}
function startMed() {
  if (medRunning && medPaused) {
    medPaused = false;
    if (medMode === 'breathing' || medMode === 'prayer') startBreathCycle();
    return;
  }
  if (medRunning) return;
  medRunning = true;
  medPaused = false;
  medRemaining = medDur * 60;
  toggleMedBtns(true);
  medInterval = setInterval(() => {
    if (medPaused) return;
    medRemaining--;
    updTimerDisp();
    if (medRemaining <= 0) completeMed();
  }, 1000);
  if (medMode === 'breathing' || medMode === 'prayer') startBreathCycle();
  document.getElementById('breathPhase').textContent = tr('inhale');
}
function pauseMed() {
  medPaused = !medPaused;
  const c = document.getElementById('breathCircle');
  if (medPaused) {
    c.style.transition = 'none';
    document.getElementById('breathPhase').textContent = '‚è∏';
    if (breathTimeout) clearTimeout(breathTimeout);
  } else {
    c.style.transition = 'transform 4s ease-in-out';
    if (medMode === 'breathing' || medMode === 'prayer') startBreathCycle();
  }
}
function stopMed() {
  const elapsed = medDur * 60 - medRemaining;
  cleanMed();
  if (elapsed >= 10) saveMedSession(elapsed);
}
function completeMed() {
  const elapsed = medDur * 60;
  cleanMed();
  saveMedSession(elapsed);
  document.getElementById('completionSub').textContent = `${Math.ceil(elapsed / 60)} ${tr('minutes')} ‚Äî ${modeLbl(medMode)}`;
  document.getElementById('completionOverlay').classList.add('show');
}
function cleanMed() {
  medRunning = false;
  medPaused = false;
  if (medInterval) { clearInterval(medInterval); medInterval = null; }
  if (breathTimeout) { clearTimeout(breathTimeout); breathTimeout = null; }
  medRemaining = medDur * 60;
  updTimerDisp();
  const c = document.getElementById('breathCircle');
  c.className = 'breathing-circle';
  c.style.transition = 'transform 4s ease-in-out';
  document.getElementById('breathInstr').innerHTML = tr('pressStart');
  document.getElementById('breathPhase').textContent = tr('readyStart');
  toggleMedBtns(false);
}
function closeCompletion() { document.getElementById('completionOverlay').classList.remove('show'); }
function toggleMedBtns(running) {
  ['btnStartMed', 'btnStartS', 'btnStartG'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.classList.toggle('hidden', running);
  });
  ['btnPauseMed', 'btnStopMed', 'btnPauseS', 'btnStopS', 'btnPauseG', 'btnStopG'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.classList.toggle('hidden', !running);
  });
}
function startBreathCycle() {
  if (breathTimeout) clearTimeout(breathTimeout);
  breathPhase = 0;
  const pat = breathPatterns[medMode] || breathPatterns.breathing;
  const c = document.getElementById('breathCircle'),
    ins = document.getElementById('breathInstr'),
    ph = document.getElementById('breathPhase');
  function next() {
    if (!medRunning || medPaused) return;
    const lbls = [tr('inhale'), tr('holdBreath'), tr('exhale'), tr('holdBreath')];
    const cls = ['inhale', 'hold', 'exhale', 'hold'];
    const ics = ['üå¨Ô∏è', '‚úã', 'üí®', '‚úã'];
    c.className = 'breathing-circle ' + cls[breathPhase];
    ins.innerHTML = ics[breathPhase] + '<br>' + lbls[breathPhase];
    ph.textContent = lbls[breathPhase];
    c.style.transition = `transform ${pat[breathPhase]}s ease-in-out`;
    const dur = pat[breathPhase] * 1000;
    breathPhase = (breathPhase + 1) % 4;
    if (pat[breathPhase] === 0) breathPhase = (breathPhase + 1) % 4;
    breathTimeout = setTimeout(next, dur);
  }
  next();
}
function modeLbl(m) {
  const l = { breathing: tr('breathingMode'), prayer: tr('prayerMode'), scripture: tr('scriptureMode'), gratitude: tr('gratitudeMode') };
  return l[m] || m;
}
function saveMedSession(sec) {
  const s = JSON.parse(localStorage.getItem('medSess') || '[]');
  s.unshift({ mode: medMode, duration: sec, date: new Date().toISOString() });
  if (s.length > 200) s.length = 200;
  localStorage.setItem('medSess', JSON.stringify(s));
  loadMedStats();
  loadMedHist();
}
function loadMedStats() {
  const s = JSON.parse(localStorage.getItem('medSess') || '[]');
  const tot = s.reduce((a, x) => a + (x.duration || 0), 0);
  document.getElementById('totalMedTime').textContent = Math.round(tot / 60);
  document.getElementById('totalMedSessions').textContent = s.length;
  document.getElementById('statMeditations').textContent = s.length;
  let streak = 0;
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  let check = new Date(today);
  while (true) {
    const ds = check.toDateString();
    if (s.some(x => new Date(x.date).toDateString() === ds)) {
      streak++;
      check.setDate(check.getDate() - 1);
    } else break;
  }
  document.getElementById('medStreak').textContent = streak;
}
function loadMedHist() {
  const s = JSON.parse(localStorage.getItem('medSess') || '[]'),
    c = document.getElementById('medHistory');
  const ic = { breathing: 'üå¨Ô∏è', prayer: 'üôè', scripture: 'üìñ', gratitude: 'üíõ' };
  c.innerHTML = s.length ? s.slice(0, 15).map(x =>
    `<div class="med-history-item"><div class="mh-info"><div class="mh-icon">${ic[x.mode] || 'üßò'}</div><div class="mh-text"><h4>${modeLbl(x.mode)}</h4><p>${timeAgo(x.date)}</p></div></div><div class="mh-duration">${Math.ceil(x.duration / 60)} min</div></div>`
  ).join('') : `<div class="empty-state"><p>${tr('noMedHistory')}</p></div>`;
}
function saveJournal() {
  const t = document.getElementById('medJournal').value.trim();
  if (!t) return;
  const e = JSON.parse(localStorage.getItem('medJ') || '[]');
  e.unshift({ text: t, date: new Date().toISOString() });
  if (e.length > 100) e.length = 100;
  localStorage.setItem('medJ', JSON.stringify(e));
  document.getElementById('medJournal').value = '';
  loadJournalEntries();
  showToast('üìì', tr('entrySaved'), 'success');
}
function loadJournalEntries() {
  const e = JSON.parse(localStorage.getItem('medJ') || '[]'),
    c = document.getElementById('journalEntries');
  c.innerHTML = e.slice(0, 8).map(x =>
    `<div class="favorite-item"><div><p style="font-size:12px">${escapeHtml(x.text.substring(0, 120))}${x.text.length > 120 ? '...' : ''}</p><p style="font-size:10px;color:var(--text-muted);margin-top:3px">${escapeHtml(timeAgo(x.date))}</p></div></div>`
  ).join('');
}
function meditateOnVerse() {
  selectMedMode('scripture', document.querySelector('.meditation-mode:nth-child(3)'));
  document.getElementById('medActiveArea').scrollIntoView({ behavior: 'smooth' });
}

// Ambient Sound
function toggleAmbient(type, btn) {
  document.querySelectorAll('.ambient-btn').forEach(b => b.classList.remove('active'));
  if (currentAmb === type) { stopAmb(); currentAmb = null; return; }
  stopAmb();
  currentAmb = type;
  if (btn) btn.classList.add('active');
  if (type === 'silence') return;
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  ambGain = audioCtx.createGain();
  ambGain.gain.value = document.getElementById('ambVol').value / 100 * 0.3;
  ambGain.connect(audioCtx.destination);
  const buf = audioCtx.createBuffer(1, 2 * audioCtx.sampleRate, audioCtx.sampleRate);
  const out = buf.getChannelData(0);
  for (let i = 0; i < out.length; i++) out[i] = Math.random() * 2 - 1;
  ambNode = audioCtx.createBufferSource();
  ambNode.buffer = buf;
  ambNode.loop = true;
  const f = audioCtx.createBiquadFilter();
  const cfg = { rain: { freq: 1200, Q: 0.7 }, ocean: { freq: 400, Q: 1.5 }, forest: { freq: 3000, Q: 0.3 }, fire: { freq: 800, Q: 2 }, birds: { freq: 4000, Q: 0.5 } };
  const c = cfg[type] || cfg.rain;
  f.type = type === 'ocean' ? 'lowpass' : type === 'birds' ? 'highpass' : 'bandpass';
  f.frequency.value = c.freq;
  f.Q.value = c.Q;
  const lfo = audioCtx.createOscillator(),
    lG = audioCtx.createGain();
  lfo.frequency.value = type === 'ocean' ? 0.1 : type === 'fire' ? 2 : 0.5;
  lG.gain.value = 0.1;
  lfo.connect(lG);
  lG.connect(ambGain.gain);
  lfo.start();
  ambNode.connect(f);
  f.connect(ambGain);
  ambNode.start();
}
function stopAmb() { try { ambNode?.stop(); } catch (e) { } ambNode = null; }
function setAmbVol(v) { if (ambGain) ambGain.gain.value = v / 100 * 0.3; }

// =============================================
// üé• LIVE (enregistrement local avec IndexedDB)
// =============================================
async function startLiveRecording() {
  const title = document.getElementById('liveTitle').value.trim();
  const desc = document.getElementById('liveDesc').value.trim();
  if (!title) {
    showToast('‚ö†Ô∏è', 'Veuillez donner un titre √† la pr√©dication', 'error');
    return;
  }
  if (!document.getElementById('enableRec').checked) {
    showToast('‚ö†Ô∏è', 'L\'enregistrement doit √™tre activ√©', 'error');
    return;
  }
  try {
    cameraStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
    document.getElementById('livePreview').srcObject = cameraStream;
    document.getElementById('liveRoom').classList.remove('hidden');
    document.getElementById('startLiveBtn').disabled = true;
    document.getElementById('liveRoomTitle').textContent = title;
    document.getElementById('liveRoomDesc').textContent = desc;

    recordedChunks = [];
    const mimeType = MediaRecorder.isTypeSupported('video/webm') ? 'video/webm' : 'video/mp4';
    mediaRecorder = new MediaRecorder(cameraStream, { mimeType });
    mediaRecorder.ondataavailable = (e) => {
      if (e.data.size > 0) recordedChunks.push(e.data);
    };
    mediaRecorder.onstop = async () => {
      const blob = new Blob(recordedChunks, { type: mimeType });
      const id = Date.now().toString();
      await saveVideoToDB(id, blob);
      const sermon = {
        id: id,
        title: title,
        description: desc,
        type: 'video',
        date: new Date().toISOString(),
        church: CHURCH.full
      };
      await addSermonToDB(sermon);
      showToast('‚úÖ', 'Pr√©dication ajout√©e √† la biblioth√®que', 'success');
      cameraStream.getTracks().forEach(t => t.stop());
      document.getElementById('livePreview').srcObject = null;
      document.getElementById('liveRoom').classList.add('hidden');
      document.getElementById('startLiveBtn').disabled = false;
      document.getElementById('livePhotosGrid').innerHTML = ''; // Clear live photos grid
      await loadSermonsFromDB();
    };
    mediaRecorder.start();
  } catch (e) {
    showToast('üìπ', 'Impossible d\'acc√©der √† la cam√©ra', 'error');
  }
}

function stopLiveRecording() {
  if (mediaRecorder && mediaRecorder.state !== 'inactive') {
    mediaRecorder.stop();
  }
}

async function toggleCamera() {
  if (cameraStream) {
    currentCameraFacing = currentCameraFacing === 'user' ? 'environment' : 'user';
    cameraStream.getTracks().forEach(t => t.stop());
    try {
      cameraStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: currentCameraFacing }, audio: true });
      document.getElementById('livePreview').srcObject = cameraStream;
    } catch (e) { showToast('üìπ', 'Impossible de changer de cam√©ra', 'error'); }
  }
}

function takePhoto() {
  const video = document.getElementById('livePreview');
  if (!video.videoWidth) {
    showToast('üì∏', 'Aucune vid√©o active', 'error');
    return;
  }
  const canvas = document.getElementById('photoCanvas');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext('2d').drawImage(video, 0, 0);
  const dataURL = canvas.toDataURL('image/jpeg', 0.8);
  
  // Sauvegarder imm√©diatement dans la galerie (localStorage)
  const gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
  const photoId = Date.now() + Math.random();
  gallery.unshift({ url: dataURL, id: photoId, church: CHURCH.full });
  localStorage.setItem('gallery', JSON.stringify(gallery));
  
  // Ajouter √† la grille des photos du live
  const grid = document.getElementById('livePhotosGrid');
  const img = document.createElement('img');
  img.src = dataURL;
  img.className = 'live-photo-item';
  img.onclick = () => { document.getElementById('zoomImg').src = dataURL; document.getElementById('imageZoomModal').classList.add('show'); };
  grid.appendChild(img);
  
  // Mettre √† jour la galerie affich√©e si elle est ouverte
  loadGalleryFromStorage();
  
  showToast('üì∏', 'Photo sauvegard√©e dans la galerie', 'success');
}

// =============================================
// IndexedDB pour les vid√©os
// =============================================
const DB_NAME = 'CER_DB';
const DB_VERSION = 1;
let dbPromise = null;

function getDB() {
  if (!dbPromise) {
    dbPromise = new Promise((resolve, reject) => {
      const request = indexedDB.open(DB_NAME, DB_VERSION);
      request.onerror = () => reject(request.error);
      request.onsuccess = () => resolve(request.result);
      request.onupgradeneeded = (e) => {
        const db = e.target.result;
        if (!db.objectStoreNames.contains('sermons')) {
          const store = db.createObjectStore('sermons', { keyPath: 'id' });
          store.createIndex('date', 'date', { unique: false });
        }
        if (!db.objectStoreNames.contains('videos')) {
          db.createObjectStore('videos', { keyPath: 'id' });
        }
      };
    });
  }
  return dbPromise;
}

async function saveVideoToDB(id, blob) {
  const db = await getDB();
  return new Promise((resolve, reject) => {
    const tx = db.transaction('videos', 'readwrite');
    const store = tx.objectStore('videos');
    const request = store.put({ id: id, blob: blob });
    request.onsuccess = () => resolve();
    request.onerror = () => reject(request.error);
  });
}

async function getVideoFromDB(id) {
  const db = await getDB();
  return new Promise((resolve, reject) => {
    const tx = db.transaction('videos', 'readonly');
    const store = tx.objectStore('videos');
    const request = store.get(id);
    request.onsuccess = () => resolve(request.result?.blob);
    request.onerror = () => reject(request.error);
  });
}

async function deleteVideoFromDB(id) {
  const db = await getDB();
  return new Promise((resolve, reject) => {
    const tx = db.transaction('videos', 'readwrite');
    const store = tx.objectStore('videos');
    const request = store.delete(id);
    request.onsuccess = () => resolve();
    request.onerror = () => reject(request.error);
  });
}

async function addSermonToDB(sermon) {
  const db = await getDB();
  return new Promise((resolve, reject) => {
    const tx = db.transaction('sermons', 'readwrite');
    const store = tx.objectStore('sermons');
    const request = store.add(sermon);
    request.onsuccess = () => resolve();
    request.onerror = () => reject(request.error);
  });
}

async function getAllSermons() {
  const db = await getDB();
  return new Promise((resolve, reject) => {
    const tx = db.transaction('sermons', 'readonly');
    const store = tx.objectStore('sermons');
    const request = store.getAll();
    request.onsuccess = () => resolve(request.result);
    request.onerror = () => reject(request.error);
  });
}

async function updateSermonInDB(id, newTitle) {
  const db = await getDB();
  const tx = db.transaction('sermons', 'readwrite');
  const store = tx.objectStore('sermons');
  const sermon = await new Promise((res, rej) => {
    const req = store.get(id);
    req.onsuccess = () => res(req.result);
    req.onerror = () => rej(req.error);
  });
  if (sermon) {
    sermon.title = newTitle;
    store.put(sermon);
  }
}

async function deleteSermonFromDB(id) {
  const db = await getDB();
  const tx = db.transaction('sermons', 'readwrite');
  const store = tx.objectStore('sermons');
  store.delete(id);
  await deleteVideoFromDB(id);
}

async function loadSermonsFromDB() {
  // R√©voquer les anciennes URLs blob
  blobUrls.forEach(url => URL.revokeObjectURL(url));
  blobUrls = [];

  const sermons = await getAllSermons();
  sermons.sort((a,b) => new Date(b.date) - new Date(a.date));
  const v = sermons.filter(s => s.type === 'video');
  document.getElementById('statSermons').textContent = sermons.length;
  const videosHtml = await Promise.all(v.map(async s => {
    const blob = await getVideoFromDB(s.id);
    const url = blob ? URL.createObjectURL(blob) : '';
    if (url) blobUrls.push(url);
    return `<div class="glass-card" data-id="${s.id}">
      <h3 style="margin-bottom:6px">${escapeHtml(s.title)}</h3>
      <video controls style="width:100%;border-radius:var(--radius-sm)" preload="metadata" src="${url}"></video>
      <div style="display:flex;justify-content:space-between;margin-top:6px">
        <span style="font-size:11px;color:var(--text-muted)">${new Date(s.date).toLocaleDateString()} ‚Äî ${escapeHtml(s.church || CHURCH.short)}</span>
        <div>
          <button class="btn btn-secondary btn-sm" onclick="renameSermon('${s.id}')">‚úèÔ∏è</button>
          <button class="btn btn-danger btn-sm" onclick="deleteSermon('${s.id}')">üóë</button>
        </div>
      </div>
    </div>`;
  }));
  document.getElementById('sermonsList').innerHTML = videosHtml.length ? videosHtml.join('') : `<div class="empty-state"><div class="empty-icon">üé¨</div><p>${tr('noSermons')}</p></div>`;
}

window.renameSermon = async (id) => {
  const newTitle = prompt('Nouveau titre :');
  if (newTitle && newTitle.trim()) {
    await updateSermonInDB(id, newTitle.trim());
    await loadSermonsFromDB();
    showToast('‚úèÔ∏è', 'Titre modifi√©', 'success');
  }
};

window.deleteSermon = async (id) => {
  if (!confirm('Supprimer cette pr√©dication ?')) return;
  await deleteSermonFromDB(id);
  await loadSermonsFromDB();
  showToast('üóë', 'Supprim√©', 'info');
};

// =============================================
// üé¨ SERMONS (YouTube)
// =============================================
function showSermonTab(t, b) {
  document.querySelectorAll('#page-sermons .tabs .tab').forEach(x => x.classList.remove('active'));
  document.querySelectorAll('#page-sermons .tab-content').forEach(x => x.classList.remove('active'));
  b.classList.add('active');
  document.getElementById('sermon-tab-' + t).classList.add('active');
}
function ytId(u) {
  const m = u.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);
  return m ? m[1] : null;
}
function addYT() {
  const u = document.getElementById('ytUrl').value.trim(),
    t = document.getElementById('ytTitle').value.trim();
  if (!u || !t) { showToast('‚ö†Ô∏è', 'Requis', 'error'); return; }
  const vid = ytId(u);
  if (!vid) { showToast('‚ö†Ô∏è', 'URL YouTube invalide', 'error'); return; }
  const sermons = JSON.parse(localStorage.getItem('ytSermons') || '[]');
  sermons.unshift({
    id: Date.now().toString(),
    title: t,
    type: 'youtube',
    youtubeId: vid,
    url: u,
    date: new Date().toISOString(),
    church: CHURCH.full
  });
  localStorage.setItem('ytSermons', JSON.stringify(sermons));
  showToast('‚ñ∂Ô∏è', tr('sermonAdded'), 'success');
  document.getElementById('ytUrl').value = '';
  document.getElementById('ytTitle').value = '';
  renderYoutubeList();
}
function renderYoutubeList() {
  const sermons = JSON.parse(localStorage.getItem('ytSermons') || '[]');
  const y = sermons;
  document.getElementById('ytList').innerHTML = y.length ? y.map(s =>
    `<div class="glass-card"><h3 style="margin-bottom:6px">${escapeHtml(s.title)}</h3><iframe class="youtube-embed" src="https://www.youtube.com/embed/${s.youtubeId}" allowfullscreen loading="lazy"></iframe><div style="display:flex;justify-content:space-between;margin-top:6px"><span style="font-size:11px;color:var(--text-muted)">${CHURCH.short}</span><button class="btn btn-danger btn-sm" onclick="deleteYTSermon('${s.id}')">üóë</button></div></div>`
  ).join('') : '<div class="empty-state"><p>Aucune vid√©o YouTube</p></div>';
}
window.deleteYTSermon = (id) => {
  let sermons = JSON.parse(localStorage.getItem('ytSermons') || '[]');
  sermons = sermons.filter(s => s.id !== id);
  localStorage.setItem('ytSermons', JSON.stringify(sermons));
  renderYoutubeList();
};

function handleVidUp(ev) {
  const file = ev.target.files[0];
  if (!file) return;
  const title = document.getElementById('vidTitle').value.trim() || file.name;
  const reader = new FileReader();
  reader.onload = async (e) => {
    const blob = new Blob([e.target.result], { type: file.type });
    const id = Date.now().toString();
    await saveVideoToDB(id, blob);
    const sermon = {
      id: id,
      title: title,
      description: '',
      type: 'video',
      date: new Date().toISOString(),
      church: CHURCH.full
    };
    await addSermonToDB(sermon);
    showToast('üé¨', tr('uploadComplete'), 'success');
    ev.target.value = '';
    document.getElementById('vidTitle').value = '';
    await loadSermonsFromDB();
  };
  reader.readAsArrayBuffer(file);
}

// =============================================
// üñº GALLERY (localStorage)
// =============================================
function loadGalleryFromStorage() {
  const photos = JSON.parse(localStorage.getItem('gallery') || '[]');
  const g = document.getElementById('galGrid');
  g.innerHTML = photos.length ? photos.map(p =>
    `<div class="gallery-item" onclick="zoomImg('${p.url}')"><img src="${p.url}" loading="lazy"><div class="delete-overlay" onclick="event.stopPropagation();deletePhoto('${p.id}')">üóë</div></div>`
  ).join('') : `<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">üì∏</div><p>${tr('noPhotos')}</p></div>`;
}
window.deletePhoto = (id) => {
  let photos = JSON.parse(localStorage.getItem('gallery') || '[]');
  photos = photos.filter(p => p.id != id);
  localStorage.setItem('gallery', JSON.stringify(photos));
  loadGalleryFromStorage();
};
function handleGalUp(ev) {
  const files = ev.target.files;
  if (!files.length) return;
  const photos = JSON.parse(localStorage.getItem('gallery') || '[]');
  Array.from(files).forEach(file => {
    const reader = new FileReader();
    reader.onload = (e) => {
      photos.unshift({ url: e.target.result, id: Date.now() + Math.random(), church: CHURCH.full });
      localStorage.setItem('gallery', JSON.stringify(photos));
      loadGalleryFromStorage();
    };
    reader.readAsDataURL(file);
  });
}
function zoomImg(u) {
  document.getElementById('zoomImg').src = u;
  document.getElementById('imageZoomModal').classList.add('show');
}

// =============================================
// PWA
// =============================================
function regSW() {
  if ('serviceWorker' in navigator) {
    // Pour une PWA fonctionnelle, il faut un fichier sw.js physique.
    console.log('Service Worker non enregistr√© (n√©cessite un fichier physique)');
  }
}

// Initialisation de la liste YouTube
renderYoutubeList();

console.log(`%c‚õ™ ${CHURCH.full}\n‚úÖ Application charg√©e avec IndexedDB`, 'color:#c9a227;font-size:14px;font-weight:bold');
</script>
</body>
</html>